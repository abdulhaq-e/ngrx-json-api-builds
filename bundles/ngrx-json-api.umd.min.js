!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs/add/operator/let"),require("lodash/index"),require("rxjs/add/operator/finally"),require("rxjs/add/observable/concat"),require("rxjs/add/observable/throw"),require("rxjs/add/operator/combineLatest"),require("rxjs/add/operator/concat"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/do"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/observable/zip"),require("@angular/common/http"),require("@ngrx/store"),require("@ngrx/effects"),require("rxjs/Observable"),require("rxjs/add/observable/of"),require("rxjs/add/operator/catch"),require("rxjs/add/operator/concatAll"),require("rxjs/add/operator/mapTo"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/switchMapTo"),require("rxjs/add/operator/take"),require("rxjs/add/operator/toArray"),require("rxjs/add/operator/withLatestFrom"),require("rxjs/add/operator/takeWhile"),require("rxjs/add/operator/takeUntil")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/add/operator/let","lodash/index","rxjs/add/operator/finally","rxjs/add/observable/concat","rxjs/add/observable/throw","rxjs/add/operator/combineLatest","rxjs/add/operator/concat","rxjs/add/operator/concatMap","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/do","rxjs/add/operator/filter","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/observable/zip","@angular/common/http","@ngrx/store","@ngrx/effects","rxjs/Observable","rxjs/add/observable/of","rxjs/add/operator/catch","rxjs/add/operator/concatAll","rxjs/add/operator/mapTo","rxjs/add/operator/switchMap","rxjs/add/operator/switchMapTo","rxjs/add/operator/take","rxjs/add/operator/toArray","rxjs/add/operator/withLatestFrom","rxjs/add/operator/takeWhile","rxjs/add/operator/takeUntil"],r):r((e.ngrx=e.ngrx||{},e.ngrx.json=e.ngrx.json||{},e.ngrx.json.api={}),e.ng.core,null,e.lodash_index,null,null,null,null,null,null,null,null,null,null,null,null,e._angular_common_http,e._ngrx_store,e._ngrx_effects,e.Rx)}(this,function(e,r,t,n,o,i,a,s,u,p,d,c,l,f,y,h,v,E,A,I){"use strict";function g(e,r,t){return t===n.get(e,r)?e:n.setWith(n.clone(e),r,t,function(e,r,t){var o=n.clone(t);return o[r]=e,o})}function _(e,r,t){var n=e[r][t];n.persistedResource?"IN_SYNC"!==n.state&&(e[r][t]=M({},e[r][t],{state:"IN_SYNC",resource:e[r][t].persistedResource})):delete e[r][t]}function P(e,r,t,o,i){var a=e[t.type][t.id];"IN_SYNC"===a.state||"NEW"===a.state&&!i||r.push(a);for(var s=0,u=o;s<u.length;s++){var p=u[s];!function(t){if(t.length>0){var s=t[0];if(a.relationships&&a.relationships[s]){var u=a.relationships[s].data;if(u){var p=[];if(o.filter(function(e){return e.length>=2&&e[0]==s}).forEach(function(e){return p.push(e.slice(1))}),n.isArray(u)){u.forEach(function(t){return P(e,r,t,p,i)})}else{P(e,r,u,p,i)}}}}}(p)}}function S(e,r,t,o){var i=[];if(n.isUndefined(r))Object.keys(e).forEach(function(r){Object.keys(e[r]).forEach(function(t){var n=e[r][t];"IN_SYNC"===n.state||"NEW"===n.state&&!o||i.push(n)})});else{var a=[];if(t)for(var s=0,u=t;s<u.length;s++){var p=u[s];a.push(p.split("."))}for(var d=0,c=r;d<c.length;d++){var l=c[d];P(e,i,l,a,o)}i=n.uniqBy(i,function(e){return e.type+"####"+e.id})}return i}function R(){return function(e){return e.select("NgrxJsonApi").map(function(e){return e}).filter(function(e){return!n.isUndefined(e)})}}function O(){return T(Q)}function T(e){return function(r){return r.let(R()).map(function(r){return r.zones[e]})}}function m(e,r){return e.NgrxJsonApi.zones[r]}function C(e){return function(r){return r.map(function(r){return r.queries[e]})}}function q(e){return function(r){return r.map(function(e){return e.data}).map(function(r){return r?r[e]:void 0})}}function w(e){return function(r){return r.let(q(e.type)).map(function(r){return r?r[e.id]:void 0})}}function b(e,r){return function(t){return t.map(function(t){var o=t.queries[e];if(o){if(n.isEmpty(o.resultIds)){return Le({},o,{data:n.isUndefined(o.resultIds)?void 0:[]})}var i=o.resultIds.map(function(e){return t.data[e.type]?t.data[e.type][e.id]:void 0});return r&&(i=$(i,t.data)),Le({},o,{data:i})}})}}function j(e,r){return function(t){return t.map(function(t){var o=t.queries[e];if(o){if(n.isEmpty(o.resultIds)){var i=Le({},o,{data:n.isUndefined(o.resultIds)?void 0:null});return i}if(o.resultIds.length>=2)throw new Error("expected single result for query "+o.query.queryId);var a=o.resultIds[0],s=t.data[a.type]?t.data[a.type][a.id]:void 0;r&&(s=H(s,t.data));var i=Le({},o,{data:s});return i}})}}function L(e){return e.let(O())}function U(e,r){void 0===e&&(e=mr);var t=r.zoneId;if(!t)return e;var n=e.zones[t];n||(n=Tr);var o=D(n,r);return n!=o?Or({},e,{zones:Or({},e.zones,(i={},i[t]=o,i))}):e;var i}function D(e,r){var t;switch(r.type){case xe.API_POST_INIT:var n=ue(e.data,r.payload,!1,!0);return t=Or({},e,{data:n,isCreating:e.isCreating+1});case xe.API_GET_INIT:var o=r.payload;return t=Or({},e,{queries:de(e.queries,o),isReading:e.isReading+1});case xe.API_PATCH_INIT:var n=ue(e.data,r.payload,!1,!1);return t=Or({},e,{data:n,isUpdating:e.isUpdating+1});case xe.API_DELETE_INIT:return t=Or({},e,{data:X(e.data,r.payload,"DELETED"),isDeleting:e.isDeleting+1});case xe.API_POST_SUCCESS:return t=Or({},e,{data:pe(e.data,r.payload.jsonApiData),isCreating:e.isCreating-1});case xe.API_GET_SUCCESS:return t=Or({},e,{data:pe(e.data,r.payload.jsonApiData),queries:ce(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case xe.API_PATCH_SUCCESS:return t=Or({},e,{data:pe(e.data,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case xe.API_DELETE_SUCCESS:return t=Or({},e,{data:ae(e.data,r.payload.query),queries:te(e.queries,{id:r.payload.query.id,type:r.payload.query.type}),isDeleting:e.isDeleting-1});case xe.API_QUERY_REFRESH:return t=Or({},e,{queries:se(e.queries,r.payload)});case xe.API_POST_FAIL:return t=Or({},e,{data:ne(e.data,r.payload.query,r.payload.jsonApiData),isCreating:e.isCreating-1});case xe.API_GET_FAIL:return t=Or({},e,{queries:le(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case xe.API_PATCH_FAIL:return t=Or({},e,{data:ne(e.data,r.payload.query,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case xe.API_DELETE_FAIL:return t=Or({},e,{data:ne(e.data,r.payload.query,r.payload.jsonApiData),isDeleting:e.isDeleting-1});case xe.REMOVE_QUERY:var i=r.payload;return t=Or({},e,{queries:fe(e.queries,i)});case xe.LOCAL_QUERY_INIT:var o=r.payload;return t=Or({},e,{queries:de(e.queries,o)});case xe.MODIFY_STORE_RESOURCE_ERRORS:var a=r.payload;return t=Or({},e,{data:oe(e.data,a.resourceId,a.errors,a.modificationType)});case xe.LOCAL_QUERY_SUCCESS:return g(e,"queries",ce(e.queries,r.payload.query.queryId,r.payload.jsonApiData));case xe.PATCH_STORE_RESOURCE:var n=ue(e.data,r.payload,!1,!1);return n!==e.data?t=Or({},e,{data:n}):e;case xe.POST_STORE_RESOURCE:var n=ue(e.data,r.payload,!1,!0);return n!==e.data?t=Or({},e,{data:n}):e;case xe.NEW_STORE_RESOURCE:var n=ue(e.data,r.payload,!1,!0);return n=X(n,r.payload,"NEW"),n!==e.data?t=Or({},e,{data:n}):e;case xe.DELETE_STORE_RESOURCE:var s=r.payload;if(e.data[s.type]&&e.data[s.type][s.id]){var u=e.data[s.type][s.id];return t="NEW"===u.state||"CREATED"===u.state?Or({},e,{data:K(e.data,s)}):Or({},e,{data:X(e.data,r.payload,"DELETED")})}return e;case xe.API_APPLY_INIT:var a=r.payload,p=S(e.data,a.ids,a.include);t=Or({},e,{isApplying:e.isApplying+1});for(var d=0,c=p;d<c.length;d++){var l=c[d];if("CREATED"===l.state)t.isCreating++;else if("UPDATED"===l.state)t.isUpdating++;else{if("DELETED"!==l.state)throw new Error("unknown state "+l.state);t.isDeleting++}}return t;case xe.API_APPLY_SUCCESS:case xe.API_APPLY_FAIL:var f=r.payload;t=e;for(var y=0,h=f;y<h.length;y++){t=D(t,h[y])}return t=Or({},t,{isApplying:e.isApplying-1});case xe.API_ROLLBACK:var a=r.payload;return t=Or({},e,{data:ie(e.data,a.ids,a.include)});case xe.CLEAR_STORE:return Tr;case xe.COMPACT_STORE:return we(e);default:return e}}function x(e,r){return new _r(e,r)}function N(){return new Ue}function z(e,r){return new hr(e,r)}function F(e){return[{provide:_r,useFactory:x,deps:[v.HttpClient,qr]},{provide:Ue,useFactory:N},{provide:hr,useFactory:z,deps:[E.Store,qr]},{provide:qr,useValue:e}]}var Q="default",J={};J.ASC=0,J.DESC=1,J[J.ASC]="ASC",J[J.DESC]="DESC";var M=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Y=function(e,r,t,o){return void 0===o&&(o=!1),e.hasOwnProperty("relationships")&&Object.keys(e.relationships).forEach(function(i){var a=e.relationships[i],s=a.data;if(!n.isUndefined(s)){var u=void 0;if(null===s)u=s;else if(n.isArray(s))if(0==s.length)u=s;else{var p=G(s,r);u=p.map(function(e){return H(e,r,t,o)})}else{var d=k(s,r);u=H(d,r,t,o)}var c=M({},a);c.reference=u,e.relationships[i]=c}}),e},$=function(e,r,t,n){void 0===t&&(t={}),void 0===n&&(n=!1);for(var o=[],i=0,a=e;i<a.length;i++){var s=a[i];o.push(H(s,r,t,n))}return o},H=function(e,r,t,o){if(void 0===t&&(t={}),void 0===o&&(o=!1),!e)return null;if(n.isUndefined(t[e.type])&&(t[e.type]={}),n.isUndefined(t[e.type][e.id])){var i=M({},e);e.relationships&&(i.relationships=M({},e.relationships)),t[i.type][i.id]=i,i=Y(i,r,t,o),i.persistedResource&&o&&(i.persistedResource=Y(i.persistedResource,r,t,o))}return t[e.type][e.id]},k=function(e,r){return n.get(r,[e.type,e.id],null)},G=function(e,r){return e.map(function(e){return k(e,r)})},W=function(e,r,t,o){var i=[];n.isUndefined(o)&&(o=".");for(var a=e.split(o),s=r,u=0;u<a.length;u++){var p=n.find(t,{type:s});if(n.isUndefined(p))throw new Error("Definition not found");if(n.isUndefined(p.attributes)&&n.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(a[u])){i.push("attributes",a[u]);break}if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");var d=p.relationships[a[u]];if("hasMany"===d.relationType){if(u!==a.length-1)throw new Error("Cannot filter past a hasMany relation");i.push("relationships",a[u],"reference")}else s=d.type,i.push("relationships",a[u],"reference")}return i.join(o)},B=function(e,r,t,o){var i=W(e,r.type,t,o);return n.get(r,i)},V=function(e,r){function t(e,r){if(n.isArray(e))return r}return n.mergeWith({},e,r,t)},Z=function(e,r,t){var o=M({},e);return o[r.id]=t?M({},r,{persistedResource:r,state:"IN_SYNC",errors:[],loading:!1}):M({},r,{persistedResource:null,state:"CREATED",errors:[],loading:!1}),n.isEqual(e,o)?e:o},K=function(e,r){if(e[r.type][r.id]){var t=M({},e);return t[r.type]=M({},t[r.type]),delete t[r.type][r.id],t}return e},X=function(e,r,t,o){if(n.isUndefined(e[r.type])||n.isUndefined(e[r.type][r.id])){if("DELETED"===t){var i=M({},e);return i[r.type]=M({},i[r.type]),i[r.type][r.id]=M({},i[r.type][r.id]),i[r.type][r.id]={type:r.type,id:r.id,persistedResource:null},i[r.type][r.id].state="NOT_LOADED",i}return e}var a=M({},e);return a[r.type]=M({},a[r.type]),a[r.type][r.id]=M({},a[r.type][r.id]),null!==t&&(a[r.type][r.id].state=t),null!=o&&(a[r.type][r.id].loading=o),a},ee=function(e,r){return e===r||null!==e==(null!==r)&&(n.isEqual(e.id,r.id)&&n.isEqual(e.type,r.type)&&n.isEqual(e.attributes,r.attributes)&&n.isEqual(e.meta,r.meta)&&n.isEqual(e.links,r.links)&&n.isEqual(e.relationships,r.relationships))},re=function(e,r,t){var o,i,a=e[r.id],s=e[r.id].persistedResource;if(t)o=r,s=r,i="IN_SYNC";else{var u=V(a,r);ee(u,s)?(o=s,i="IN_SYNC"):(o=u,i=null!==s?"UPDATED":"NEW"===a.state?"NEW":"CREATED")}var p=M({},e);return p[r.id]=M({},o,{persistedResource:s,state:i,errors:[],loading:!1}),n.isEqual(p[r.id],e[r.id])?e:p},te=function(e,r){var t=e;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if(o.query.id===r.id&&o.query.type===r.type){t=se(t,o.query.queryId);var i={code:"404",status:"Not Found"};t[o.query.queryId].errors=[i]}}return t},ne=function(e,r,t){if(!r.type||!r.id||t.data instanceof Array)throw new Error("invalid parameters");return oe(e,{id:r.id,type:r.type},t.errors,"SET")},oe=function(e,r,t,o){if(!e[r.type]||!e[r.type][r.id])return e;var i=M({},e);i[r.type]=M({},i[r.type]);var a=M({},i[r.type][r.id]);if("SET"===o)a.errors=[],t&&(c=a.errors).push.apply(c,t);else if("ADD"===o){var s=a.errors;a.errors=[],s&&(l=a.errors).push.apply(l,s),t&&(f=a.errors).push.apply(f,t)}else{var s=a.errors;if(a.errors=[],s)for(var u=0,p=s;u<p.length;u++){var d=p[u];!function(e){t&&t.filter(function(r){return n.isEqual(r,e)}).length>0||a.errors.push(e)}(d)}}return i[r.type][r.id]=a,i;var c,l,f},ie=function(e,r,t){var o=M({},e);if(n.isUndefined(r))Object.keys(o).forEach(function(e){o[e]=M({},o[e]),Object.keys(o[e]).forEach(function(r){_(o,e,r)})});else for(var i=S(o,r,t,!0),a=0,s=i;a<s.length;a++){var u=s[a];_(o,u.type,u.id)}return o},ae=function(e,r){var t=M({},e);return void 0===r.id?t[r.type]={}:t[r.type]=n.omit(t[r.type],[r.id]),t},se=function(e,r){var t=M({},e[r]);delete t.resultIds,delete t.errors,delete t.meta,delete t.links;var n=M({},e);return n[r]=t,n},ue=function(e,r,t,o){if(n.isUndefined(e[r.type])){var i=M({},e);return i[r.type]={},i[r.type]=Z(i[r.type],r,t),i}if(n.isUndefined(e[r.type][r.id])||o){var a=Z(e[r.type],r,t);if(a!==e[r.type]){var i=M({},e);return i[r.type]=a,i}return e}var a=re(e[r.type],r,t);if(a!==e[r.type]){var i=M({},e);return i[r.type]=a,i}return e},pe=function(e,r){var t=n.get(r,"data");if(n.isUndefined(t))return e;var o=n.isArray(t)?t:[t],i=n.get(r,"included");n.isUndefined(i)||(o=o.concat(i));for(var a=M({},e),s=!1,u=0,p=o;u<p.length;u++){var d=p[u],c=M({},d,{persistedResource:d,state:"IN_SYNC",errors:[],loading:!1});n.isEqual(c,d)||(s=!0,a[d.type]?a[d.type]===e[d.type]&&(a[d.type]=M({},e[d.type])):a[d.type]={},a[d.type][d.id]=c)}return s?a:e},de=function(e,r){if(!r.queryId)return e;var t=M({},e[r.queryId]);t.loading=!0,t.query=n.cloneDeep(r),n.isUndefined(t.errors)&&(t.errors=[]);var o=M({},e);return o[t.query.queryId]=t,o},ce=function(e,r,t){var o=e[r];if(o){var i=n.isArray(t.data)?t.data:[t.data],a=M({},o,{resultIds:i.map(function(e){return e?ye(e):[]}),meta:t.meta,links:t.links,loading:!1});if(!n.isEqual(a,o)){var s=M({},e);return s[r]=a,s}}return e},le=function(e,r,t){if(!r||!e[r])return e;var n=M({},e),o=M({},n[r]);return o.errors=[],o.loading=!1,t.errors&&(i=o.errors).push.apply(i,t.errors),n[r]=o,n;var i},fe=function(e,r){var t=M({},e);return delete t[r],t},ye=function(e){return{type:e.type,id:e.id}},he=function(e,r,t,o,i){n.isUndefined(i)&&(i=".");for(var a=e.split(i),s=r,u=0;u<a.length;u++){var p=n.find(o,{type:s.type});if(n.isUndefined(p))throw new Error("Definition not found");if(n.isUndefined(p.attributes)&&n.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(a[u]))return n.get(s,"attributes."+a[u],null);if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");if(u===a.length-1)throw new Error("The last field in the filtering path cannot be a relation");var d=p.relationships[a[u]];if("hasMany"===d.relationType)throw new Error("Cannot filter past a hasMany relation");var c=n.get(s,"relationships."+a[u],null);if(!c||!c.data)return null;var l=[d.type,c.data.id];if(s=n.get(t,l),n.isUndefined(s))return null}},ve=function(e,r,t,o,i){return n.filter(e,function(e){return!t.hasOwnProperty("params")||!t.params.hasOwnProperty("filtering")||t.params.filtering.every(function(t){var a,s;n.isUndefined(i)||(a=n.get(i,"pathSeparator"),s=n.get(i,"filteringOperators"));var u=he(t.path,e,r,o,a);if(!u)return!1;var p=n.find(s,{name:t.operator});if(p)return p.comparison(t.value,u);switch(t.operator=t.hasOwnProperty("operator")?t.operator:"iexact",t.operator){case"iexact":return n.isString(t.value)&&n.isString(u)?t.value.toLowerCase()===u.toLowerCase():t.value===u;case"exact":return t.value===u;case"contains":return n.includes(u,t.value);case"icontains":return n.includes(u.toLowerCase(),t.value.toLowerCase());case"in":return n.isArray(t.value)?n.includes(t.value,u):n.includes([t.value],u);case"gt":return t.value>u;case"gte":return t.value>=u;case"lt":return t.value<u;case"lte":return t.value<=u;case"startswith":return n.startsWith(u,t.value);case"istartswith":return n.startsWith(u.toLowerCase(),t.value.toLowerCase());case"endswith":return n.endsWith(u,t.value);case"iendswith":return n.endsWith(u.toLowerCase(),t.value.toLowerCase());default:return!0}})})},Ee=function(e){return n.isEmpty(e)?"":"include="+e.join()},Ae=function(e){return n.isEmpty(e)?"":"fields="+e.join()},Ie=function(e){return n.isEmpty(e)?"":e.map(function(e){return"filter["+e.path+"]"+(e.operator?"["+e.operator+"]":"")+"="+encodeURIComponent(e.value)}).join("&")},ge=function(e){return n.isEmpty(e)?"":"sort="+e.map(function(e){return(e.direction===J.ASC?"":"-")+e.api}).join(",")},_e=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e.filter(function(e){return""!==e});return 0!==t.length?"?"+t.join("&"):""},Pe=function(e,r){var t={query:{type:e.type}};return"POST"!==r&&"PATCH"!==r||(t.jsonApiData={data:{id:e.id,type:e.type,attributes:e.attributes,relationships:e.relationships}}),"POST"===r&&e.hasTemporaryId&&delete t.jsonApiData.data.id,"PATCH"!==r&&"DELETE"!==r&&"POST"!==r||(t.query.id=e.id),t},Se=function(){for(var e=[],r=0;r<256;r++)e[r]=(r<16?"0":"")+r.toString(16);var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&o|128]+e[o>>8&255]+"-"+e[o>>16&255]+e[o>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]},Re=function(e){return e.id+"@"+e.type},Oe=function(e,r){for(var t in e.queries)if(e.queries.hasOwnProperty(t)){var n=e.queries[t];if(n.resultIds)for(var o=0,i=n.resultIds;o<i.length;o++){var a=i[o];r[Re(a)]=!0}}},Te=function(e,r){for(var t in e.data)if(e.data.hasOwnProperty(t)){var n=e.data[t];for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];"IN_SYNC"!==i.state&&(r[Re(i)]=!0)}}},me=function(e,r,t){var n;for(var o in t.relationships)if(t.relationships.hasOwnProperty(o)){var i=t.relationships[o].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],d=Re(p);r[d]||(n=!0,r[d]=!0)}}return n},Ce=function(e,r){for(;;){var t=!1;for(var n in e.data)if(e.data.hasOwnProperty(n)){var o=e.data[n];for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];r[Re(a)]&&(t=t||me(0,r,a))}}if(!t)break}},qe=function(e,r){var t=!1,o=n.cloneDeep(e);for(var i in o.data)if(o.data.hasOwnProperty(i)){var a=o.data[i];for(var s in a)if(a.hasOwnProperty(s)){var u=a[s];r[Re(u)]||(t=!0,delete a[s])}n.isEmpty(a)&&delete o.data[i]}return t?o:e},we=function(e){var r={};return Oe(e,r),Te(e,r),Ce(e,r),qe(e,r)},be=function(e){for(var r={},t={},n=0,o=e;n<o.length;n++){var i=o[n],a=i,s=Re(a);r[s]=[],t[s]=i}for(var u=0,p=e;u<p.length;u++){var i=p[u];!function(e){var n=e;if(n.relationships){var o=Re(n);Object.keys(n.relationships).forEach(function(e){var i=n.relationships[e].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],d=Re(p);t[d]&&"CREATED"===t[d].state&&r[o].push(t[d])}})}}(i)}for(var d={pendingResources:e,cursor:e.length,sorted:new Array(e.length),dependencies:r,visited:[]},c=d.cursor;c--;)d.visited[c]||je(e[c],c,[],d);return d.sorted},je=function(e,r,t,n){var o=Re(e);if(t.indexOf(o)>=0)throw new Error("Cyclic dependency: "+o+" with "+JSON.stringify(t));if(!n.visited[r]){n.visited[r]=!0;for(var i=n.dependencies[o],a=t.concat(o),s=0,u=i;s<u.length;s++){var p=u[s];je(p,n.pendingResources.indexOf(p),a,n)}n.sorted[--n.cursor]=e}},Le=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Ue=function(){function e(){}return e.prototype.getNgrxJsonApiStore$=function(){return function(e){return e.let(O())}},e.prototype.getStoreData$=function(){return function(e){return e.select("data")}},e.prototype.getStoreResourceOfType$=function(e){var r=this;return function(t){return t.let(r.getStoreData$()).map(function(r){return r?r[e]:void 0})}},e.prototype.getStoreQueries$=function(){return function(e){return e.select("queries")}},e.prototype.getResourceQuery$=function(e){return C(e)},e.prototype.getStoreResource$=function(e){return w(e)},e.prototype.getManyResults$=function(e,r){return b(e,r)},e.prototype.getOneResult$=function(e,r){return j(e,r)},e.prototype.getPersistedResource$=function(e){var r=this;return function(t){return t.let(r.getStoreResource$(e)).map(function(e){return e?e.persistedResource:void 0})}},e}(),De=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),xe={API_POST_INIT:"[NgrxJsonApi] API_POST_INIT",API_POST_SUCCESS:"[NgrxJsonApi] API_POST_SUCCESS",API_POST_FAIL:"[NgrxJsonApi] API_POST_FAIL",API_GET_INIT:"[NgrxJsonApi] API_GET_INIT",API_GET_SUCCESS:"[NgrxJsonApi] API_GET_SUCCESS",API_GET_FAIL:"[NgrxJsonApi] API_GET_FAIL",API_PATCH_INIT:"[NgrxJsonApi] API_PATCH_INIT",API_PATCH_SUCCESS:"[NgrxJsonApi] API_PATCH_SUCCESS",API_PATCH_FAIL:"[NgrxJsonApi] API_PATCH_FAIL",API_DELETE_INIT:"[NgrxJsonApi] API_DELETE_INIT",API_DELETE_SUCCESS:"[NgrxJsonApi] API_DELETE_SUCCESS",API_DELETE_FAIL:"[NgrxJsonApi] API_DELETE_FAIL",API_APPLY_INIT:"[NgrxJsonApi] API_APPLY_INIT",API_APPLY_SUCCESS:"[NgrxJsonApi] API_APPLY_SUCCESS",API_APPLY_FAIL:"[NgrxJsonApi] API_APPLY_FAIL",API_ROLLBACK:"[NgrxJsonApi] API_ROLLBACK",API_QUERY_REFRESH:"[NgrxJsonApi] API_QUERY_REFRESH",LOCAL_QUERY_INIT:"[NgrxJsonApi] LOCAL_QUERY_INIT",LOCAL_QUERY_SUCCESS:"[NgrxJsonApi] LOCAL_QUERY_SUCCESS",LOCAL_QUERY_FAIL:"[NgrxJsonApi] LOCAL_QUERY_FAIL",DELETE_STORE_RESOURCE:"[NgrxJsonApi] DELETE_STORE_RESOURCE",PATCH_STORE_RESOURCE:"[NgrxJsonApi] PATCH_STORE_RESOURCE",NEW_STORE_RESOURCE:"[NgrxJsonApi] NEW_STORE_RESOURCE",POST_STORE_RESOURCE:"[NgrxJsonApi] POST_STORE_RESOURCE",MODIFY_STORE_RESOURCE_ERRORS:"[NgrxJsonApi] MODIFY_STORE_RESOURCE_ERRORS",REMOVE_QUERY:"[NgrxJsonApi] REMOVE_QUERY",COMPACT_STORE:"[NgrxJsonApi] COMPACT_STORE",CLEAR_STORE:"[NgrxJsonApi] CLEAR_STORE"},Ne=function(){function e(){}return e}(),ze=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_APPLY_INIT,n}return De(r,e),r}(Ne),Fe=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_APPLY_SUCCESS,n}return De(r,e),r}(Ne),Qe=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_APPLY_FAIL,n}return De(r,e),r}(Ne),Je=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_POST_INIT,n}return De(r,e),r}(Ne),Me=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_POST_SUCCESS,n}return De(r,e),r}(Ne),Ye=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_POST_FAIL,n}return De(r,e),r}(Ne),$e=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_DELETE_INIT,n}return De(r,e),r}(Ne),He=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_DELETE_SUCCESS,n}return De(r,e),r}(Ne),ke=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_DELETE_FAIL,n}return De(r,e),r}(Ne),Ge=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_GET_INIT,n}return De(r,e),r}(Ne),We=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_GET_SUCCESS,n}return De(r,e),r}(Ne),Be=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_GET_FAIL,n}return De(r,e),r}(Ne),Ve=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_ROLLBACK,n}return De(r,e),r}(Ne),Ze=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_PATCH_INIT,n}return De(r,e),r}(Ne),Ke=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_PATCH_SUCCESS,n}return De(r,e),r}(Ne),Xe=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.API_PATCH_FAIL,n}return De(r,e),r}(Ne),er=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.DELETE_STORE_RESOURCE,n}return De(r,e),r}(Ne),rr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.PATCH_STORE_RESOURCE,n}return De(r,e),r}(Ne),tr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.NEW_STORE_RESOURCE,n}return De(r,e),r}(Ne),nr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.POST_STORE_RESOURCE,n}return De(r,e),r}(Ne),or=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.REMOVE_QUERY,n}return De(r,e),r}(Ne),ir=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.LOCAL_QUERY_INIT,n}return De(r,e),r}(Ne),ar=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.LOCAL_QUERY_SUCCESS,n}return De(r,e),r}(Ne),sr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.LOCAL_QUERY_FAIL,n}return De(r,e),r}(Ne),ur=function(e){function r(r){var t=e.call(this)||this;return t.zoneId=r,t.type=xe.COMPACT_STORE,t}return De(r,e),r}(Ne),pr=function(e){function r(r){var t=e.call(this)||this;return t.zoneId=r,t.type=xe.CLEAR_STORE,t}return De(r,e),r}(Ne),dr=function(e){function r(r,t){var n=e.call(this)||this;if(n.payload=r,n.zoneId=t,n.type=xe.API_QUERY_REFRESH,!r)throw new Error("no query id provided for ApiQueryRefreshAction");return n}return De(r,e),r}(Ne),cr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=xe.MODIFY_STORE_RESOURCE_ERRORS,n}return De(r,e),r}(Ne),lr=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),fr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},yr=function(){function e(e,r){this.zoneId=e,this.store=r}return e.prototype.putQuery=function(e){var r=e.query,t=!!n.isUndefined(e.fromServer)||e.fromServer;if(!r.queryId)throw new Error("to query must have a queryId");t?this.store.dispatch(new Ge(r,this.zoneId)):this.store.dispatch(new ir(r,this.zoneId))},e.prototype.refreshQuery=function(e){this.store.dispatch(new dr(e,this.zoneId))},e.prototype.removeQuery=function(e){this.store.dispatch(new or(e,this.zoneId))},e.prototype.selectManyResults=function(e,r){return void 0===r&&(r=!1),this.store.let(T(this.zoneId)).let(b(e,r))},e.prototype.selectOneResults=function(e,r){return void 0===r&&(r=!1),this.store.let(T(this.zoneId)).let(j(e,r))},e.prototype.selectStoreResource=function(e){return this.store.let(T(this.zoneId)).let(w(e))},e.prototype.patchResource=function(e){var r=e.resource;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new Ze(r,this.zoneId)):this.store.dispatch(new rr(r,this.zoneId))},e.prototype.newResource=function(e){var r=e.resource;this.store.dispatch(new tr(r,this.zoneId))},e.prototype.postResource=function(e){var r=e.resource;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new Je(r,this.zoneId)):this.store.dispatch(new nr(r,this.zoneId))},e.prototype.deleteResource=function(e){var r=e.resourceId;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new $e(r,this.zoneId)):this.store.dispatch(new er(r,this.zoneId))},e.prototype.apply=function(){this.store.dispatch(new ze({},this.zoneId))},e.prototype.clear=function(){this.store.dispatch(new pr(this.zoneId))},e.prototype.compact=function(){this.store.dispatch(new ur(this.zoneId))},e.prototype.addResourceErrors=function(e,r){this.store.dispatch(new cr({resourceId:e,errors:r,modificationType:"ADD"},this.zoneId))},e.prototype.removeResourceErrors=function(e,r){this.store.dispatch(new cr({resourceId:e,errors:r,modificationType:"REMOVE"},this.zoneId))},e.prototype.setResourceErrors=function(e,r){this.store.dispatch(new cr({resourceId:e,errors:r,modificationType:"SET"},this.zoneId))},e}(),hr=function(e){function r(r,t){var n=e.call(this,Q,r)||this;return n.config=t,n.test=!0,n}return lr(r,e),r.prototype.getDefaultZone=function(){return this},r.prototype.getZone=function(e){return new yr(e,this.store)},r.prototype.findOne=function(e){return this.findInternal(e,!1)},r.prototype.findMany=function(e){return this.findInternal(e,!0)},Object.defineProperty(r.prototype,"storeSnapshot",{get:function(){var e=this;if(!this._storeSnapshot&&(this.store.let(O()).subscribe(function(r){return e._storeSnapshot=r}),!this._storeSnapshot))throw new Error("failed to initialize store snapshot");return this._storeSnapshot},enumerable:!0,configurable:!0}),r.prototype.findInternal=function(e,r){var t,o=this,i=e.query,a=!!n.isUndefined(e.fromServer)||e.fromServer,s=!n.isUndefined(e.denormalise)&&e.denormalise;t=i.queryId?i:fr({},i,{queryId:this.uuid()}),this.putQuery({query:t,fromServer:a});var u;return u=r?this.selectManyResults(t.queryId,s):this.selectOneResults(t.queryId,s),u.finally(function(){return o.removeQuery(t.queryId)})},r.prototype.uuid=function(){return Se()},r.prototype.getPersistedResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id].persistedResource:null},r.prototype.getResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id]:null},r.prototype.denormaliseResource=function(e){return e.combineLatest(this.store.let(T(this.zoneId)).map(function(e){return e.data}),function(e,r){return n.isArray(e)?$(e,r):H(e,r)})},r.prototype.getDenormalisedPath=function(e,r){var t=n.get(this.config,"filteringConfig.pathSeparator");return W(e,r,this.config.resourceDefinitions,t)},r.prototype.getDenormalisedValue=function(e,r){var t=n.get(this.config,"filteringConfig.pathSeparator");return B(e,r,this.config.resourceDefinitions,t)},r}(yr),vr=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.selectStoreResource(e)},e.decorators=[{type:r.Pipe,args:[{name:"jaSelectStoreResource"}]}],e.ctorParameters=function(){return[{type:hr}]},e}(),Er=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.denormaliseResource(e)},e.decorators=[{type:r.Pipe,args:[{name:"denormaliseStoreResource"}]}],e.ctorParameters=function(){return[{type:hr}]},e}(),Ar=function(){function e(e){this.service=e}return e.prototype.transform=function(e,r){return this.service.getDenormalisedValue(e,r)},e.decorators=[{type:r.Pipe,args:[{name:"getDenormalisedValue"}]}],e.ctorParameters=function(){return[{type:hr}]},e}(),Ir=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},gr=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n])
;if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&(t[n[o]]=e[n[o]]);return t},_r=function(){function e(e,r){if(this.http=e,this.config=r,this.headers=new v.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}),this.definitions=this.config.resourceDefinitions,this.config.requestHeaders)for(var t=0,o=n.keys(this.config.requestHeaders);t<o.length;t++){var i=o[t],a=this.config.requestHeaders[i];this.headers=this.headers.set(i,a)}}return e.prototype.urlBuilder=function(e,r){switch(r){case"GET":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);if(e.type)return this.collectionUrlFor(e.type);case"DELETE":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"PATCH":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"POST":return this.collectionUrlFor(e.type)}},e.prototype.collectionPathFor=function(e){var r=n.find(this.definitions,{type:e});return r?""+r.collectionPath:e},e.prototype.collectionUrlFor=function(e){var r=this.collectionPathFor(e);return this.config.apiUrl+"/"+r},e.prototype.resourcePathFor=function(e,r){return this.collectionPathFor(e)+"/"+encodeURIComponent(r)},e.prototype.resourceUrlFor=function(e,r){var t=this.resourcePathFor(e,r);return this.config.apiUrl+"/"+t},e.prototype.find=function(e){var r=Ee,t=Ie,o=Ae,i=ge,a=_e;if(this.config.hasOwnProperty("urlBuilder")){var s=this.config.urlBuilder;s.generateIncludedQueryParams&&(r=s.generateIncludedQueryParams),s.generateFilteringQueryParams&&(t=s.generateFilteringQueryParams),s.generateFieldsQueryParams&&(o=s.generateFieldsQueryParams),s.generateSortingQueryParams&&(i=s.generateSortingQueryParams),s.generateQueryParams&&(a=s.generateQueryParams)}var u="",p="",d="",c="",l="",f="",y="";if(void 0===typeof e)return I.Observable.throw("Query not found");e.hasOwnProperty("params")&&!n.isEmpty(e.params)&&(n.hasIn(e.params,"include")&&(p=r(e.params.include)),n.hasIn(e.params,"filtering")&&(d=t(e.params.filtering)),n.hasIn(e.params,"sorting")&&(c=i(e.params.sorting)),n.hasIn(e.params,"fields")&&(l=o(e.params.fields)),n.hasIn(e.params,"limit")&&(y="page[limit]="+e.params.limit),n.hasIn(e.params,"offset")&&(f="page[offset]="+e.params.offset)),u=a(p,d,c,l,f,y);var h={method:"GET",url:this.urlBuilder(e,"GET")+u};return this.request(h)},e.prototype.create=function(e,r){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof r)return I.Observable.throw("Data not found");var t={method:"POST",url:this.urlBuilder(e,"POST"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.update=function(e,r){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof r)return I.Observable.throw("Data not found");var t={method:"PATCH",url:this.urlBuilder(e,"PATCH"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.delete=function(e){if(void 0===typeof e)return I.Observable.throw("Query not found");var r={method:"DELETE",url:this.urlBuilder(e,"DELETE")};return this.request(r)},e.prototype.request=function(e){var r=Ir({},e,{headers:this.headers,observe:"response"});if("GET"===e.method){var t=(r.method,r.url),n=gr(r,["method","url"]);return this.http.get(t,n)}if("POST"===e.method){var t=(r.method,r.url),o=r.body,n=gr(r,["method","url","body"]);return this.http.post(t,o,n)}if("PATCH"===e.method){var t=(r.method,r.url),o=r.body,n=gr(r,["method","url","body"]);return this.http.patch(t,o,n)}if("DELETE"===e.method){var t=(r.method,r.url),n=gr(r,["method","url"]);return this.http.delete(t,n)}},e}(),Pr=function(e,r,t,n){var o,i=arguments.length,a=i<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,r,t,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(r,t,a):o(r,t))||a);return i>3&&a&&Object.defineProperty(r,t,a),a},Sr=function(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)},Rr=function(){function e(e,r,t){var o=this;this.actions$=e,this.jsonApi=r,this.store=t,this.createResource$=this.actions$.ofType(xe.API_POST_INIT).mergeMap(function(e){var r=o.generatePayload(e.payload,"POST");return o.jsonApi.create(r.query,r.jsonApiData).map(function(t){return new Me({jsonApiData:t.body,query:r.query},e.zoneId)}).catch(function(t){return I.Observable.of(new Ye(o.toErrorPayload(r.query,t),e.zoneId))})}),this.updateResource$=this.actions$.ofType(xe.API_PATCH_INIT).mergeMap(function(e){var r=o.generatePayload(e.payload,"PATCH");return o.jsonApi.update(r.query,r.jsonApiData).map(function(t){return new Ke({jsonApiData:t.body,query:r.query},e.zoneId)}).catch(function(t){return I.Observable.of(new Xe(o.toErrorPayload(r.query,t),e.zoneId))})}),this.readResource$=this.actions$.ofType(xe.API_GET_INIT).mergeMap(function(e){var r=e.payload;return o.jsonApi.find(r).map(function(e){return e.body}).map(function(t){return new We({jsonApiData:t,query:r},e.zoneId)}).catch(function(t){return I.Observable.of(new Be(o.toErrorPayload(r,t),e.zoneId))})}),this.queryStore$=this.actions$.ofType(xe.LOCAL_QUERY_INIT).mergeMap(function(e){var r=e.payload;return o.store.let(T(e.zoneId)).let(o.executeLocalQuery(r)).map(function(t){return new ar({jsonApiData:{data:t},query:r},e.zoneId)}).catch(function(t){return I.Observable.of(new sr(o.toErrorPayload(r,t),e.zoneId))}).takeUntil(o.localQueryInitEventFor(r)).takeUntil(o.removeQueryEventFor(r))}),this.deleteResource$=this.actions$.ofType(xe.API_DELETE_INIT).mergeMap(function(e){var r=o.generatePayload(e.payload,"DELETE");return o.jsonApi.delete(r.query).map(function(e){return e.body}).map(function(t){return new He({jsonApiData:t,query:r.query},e.zoneId)}).catch(function(t){return I.Observable.of(new ke(o.toErrorPayload(r.query,t),e.zoneId))})}),this.triggerReadOnQueryRefresh$=this.actions$.ofType(xe.API_QUERY_REFRESH).withLatestFrom(this.store,function(e,r){var t=e.payload,n=m(r,e.zoneId),o=n.queries[t].query;return new Ge(o,e.zoneId)}),this.refreshQueriesOnDelete$=this.actions$.ofType(xe.API_DELETE_SUCCESS).withLatestFrom(this.store,function(e,r){var t={id:e.payload.query.id,type:e.payload.query.type};if(!t.id||!t.type)throw new Error("API_DELETE_SUCCESS did not carry resource id and type information");var o=m(r,e.zoneId),i=[];for(var a in o.queries)if(o.queries.hasOwnProperty(a)){var s=o.queries[a];if(s.resultIds){var u=-1!==n.findIndex(s.resultIds,function(e){return n.isEqual(t,e)}),p=s.query.id===t.id&&s.query.type===t.type;if(p&&(u||n.isEmpty(s.errors)))throw new Error("store is in invalid state, queries for deleted resource should have been emptied and marked with 404 error");u&&i.push(new dr(a,e.zoneId))}}return i}).flatMap(function(e){return I.Observable.of.apply(I.Observable,e)}),this.applyResources$=this.actions$.ofType(xe.API_APPLY_INIT).filter(function(){return!1!==o.jsonApi.config.applyEnabled}).withLatestFrom(this.store,function(e,r){var t=m(r,e.zoneId),n=e.payload,i=S(t.data,n.ids,n.include);if(0===i.length)return I.Observable.of(new Fe([],e.zoneId));for(var a=be(i),s=[],u=0,p=a;u<p.length;u++){var d=p[u];if("CREATED"===d.state)s.push(o.handlePendingCreate(d,e.zoneId));else if("UPDATED"===d.state)s.push(o.handlePendingUpdate(d,e.zoneId));else{if("DELETED"!==d.state)throw new Error("unknown state "+d.state);s.push(o.handlePendingDelete(d,e.zoneId))}}return I.Observable.of.apply(I.Observable,s).concatAll().toArray().map(function(r){return o.toApplyAction(r,e.zoneId)})}).flatMap(function(e){return e}),this.config=this.jsonApi.config}return e.prototype.localQueryInitEventFor=function(e){return this.actions$.ofType(xe.LOCAL_QUERY_INIT).map(function(e){return e}).filter(function(r){return e.queryId==r.payload.queryId})},e.prototype.removeQueryEventFor=function(e){return this.actions$.ofType(xe.REMOVE_QUERY).map(function(e){return e}).filter(function(r){return e.queryId==r.payload})},e.prototype.executeLocalQuery=function(e){var r=this;return function(t){var n;return e.type?(n=e.type&&e.id?t.let(w({type:e.type,id:e.id})):t.let(q(e.type)).combineLatest(t.map(function(e){return e.data}),function(t,n){return ve(t,n,e,r.config.resourceDefinitions,r.config.filteringConfig)}),n.distinctUntilChanged()):t.map(function(){return I.Observable.throw("Unknown query")})}},e.prototype.handlePendingCreate=function(e,r){var t=this,n=this.generatePayload(e,"POST");return this.jsonApi.create(n.query,n.jsonApiData).map(function(e){return new Me({jsonApiData:e.body,query:n.query},r)}).catch(function(e){return I.Observable.of(new Ye(t.toErrorPayload(n.query,e),r))})},e.prototype.handlePendingUpdate=function(e,r){var t=this,n=this.generatePayload(e,"PATCH");return this.jsonApi.update(n.query,n.jsonApiData).map(function(e){return new Ke({jsonApiData:e.body,query:n.query},r)}).catch(function(e){return I.Observable.of(new Xe(t.toErrorPayload(n.query,e),r))})},e.prototype.handlePendingDelete=function(e,r){var t=this,n=this.generatePayload(e,"DELETE");return this.jsonApi.delete(n.query).map(function(e){return new He({jsonApiData:e.body,query:n.query},r)}).catch(function(e){return I.Observable.of(new ke(t.toErrorPayload(n.query,e),r))})},e.prototype.ngOnDestroy=function(){},e.prototype.toApplyAction=function(e,r){for(var t=0,n=e;t<n.length;t++){var o=n[t];if(o.type===xe.API_POST_FAIL||o.type===xe.API_PATCH_FAIL||o.type===xe.API_DELETE_FAIL)return new Qe(e,r)}return new Fe(e,r)},e.prototype.toErrorPayload=function(e,r){var t=null;r&&r.headers&&(t=r.headers.get("Content-Type"));var n=null;if(null!=t&&t.startsWith("application/vnd.api+json")&&(n=r),n&&n.error&&n.error.errors&&n.error.errors.length>0)return{query:e,jsonApiData:n.error};var o=[],i={status:String(r.status),code:r.statusText};return o.push(i),{query:e,jsonApiData:{errors:o}}},e.prototype.generatePayload=function(e,r){return Pe(e,r)},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:A.Actions},{type:_r},{type:E.Store}]},Pr([A.Effect(),Sr("design:type",I.Observable)],e.prototype,"createResource$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"updateResource$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"readResource$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"queryStore$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"deleteResource$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"triggerReadOnQueryRefresh$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"refreshQueriesOnDelete$",void 0),Pr([A.Effect(),Sr("design:type",Object)],e.prototype,"applyResources$",void 0),e}(),Or=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Tr={isCreating:0,isReading:0,isUpdating:0,isDeleting:0,isApplying:0,data:{},queries:{}},mr={zones:{}},Cr=U,qr=new r.InjectionToken("NGRX_JSON_API_CONFIG"),wr=function(){function e(){}return e.configure=function(r){return{ngModule:e,providers:F(r)}},e.decorators=[{type:r.NgModule,args:[{declarations:[Er,Ar,vr],imports:[A.EffectsModule.forFeature([Rr]),E.StoreModule.forFeature("NgrxJsonApi",Cr,{})],exports:[Er,Ar,vr]}]}],e.ctorParameters=function(){return[]},e}();e.SelectStoreResourcePipe=vr,e.DenormaliseStoreResourcePipe=Er,e.GetDenormalisedValuePipe=Ar,e.NgrxJsonApiService=hr,e.NgrxJsonApiZoneService=yr,e.NgrxJsonApiModule=wr,e.NGRX_JSON_API_CONFIG=qr,e.uuid=Se,e.NGRX_JSON_API_DEFAULT_ZONE=Q,e.Direction=J,e.NgrxJsonApiActionTypes=xe,e.NgrxJsonApiAction=Ne,e.ApiApplyInitAction=ze,e.ApiApplySuccessAction=Fe,e.ApiApplyFailAction=Qe,e.ApiPostInitAction=Je,e.ApiPostSuccessAction=Me,e.ApiPostFailAction=Ye,e.ApiDeleteInitAction=$e,e.ApiDeleteSuccessAction=He,e.ApiDeleteFailAction=ke,e.ApiGetInitAction=Ge,e.ApiGetSuccessAction=We,e.ApiGetFailAction=Be,e.ApiRollbackAction=Ve,e.ApiPatchInitAction=Ze,e.ApiPatchSuccessAction=Ke,e.ApiPatchFailAction=Xe,e.DeleteStoreResourceAction=er,e.PatchStoreResourceAction=rr,e.NewStoreResourceAction=tr,e.PostStoreResourceAction=nr,e.RemoveQueryAction=or,e.LocalQueryInitAction=ir,e.LocalQuerySuccessAction=ar,e.LocalQueryFailAction=sr,e.CompactStoreAction=ur,e.ClearStoreAction=pr,e.ApiQueryRefreshAction=dr,e.ModifyStoreResourceErrorsAction=cr,e.selectNgrxJson=R,e.selectNgrxJsonApiDefaultZone=O,e.selectNgrxJsonApiZone=T,e.getNgrxJsonApiZone=m,e.selectStoreQuery=C,e.selectStoreResourcesOfType=q,e.selectStoreResource=w,e.selectManyQueryResult=b,e.selectOneQueryResult=j,e.getNgrxJsonApiStore=L,e.NgrxJsonApiSelectors=Ue,e.ɵf=_r,e.ɵe=Rr,e.ɵa=x,e.ɵd=F,e.ɵb=N,e.ɵc=z,e.ɵg=U,e.ɵh=Cr,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/bundles/ngrx-json-api.umd.min.js.map