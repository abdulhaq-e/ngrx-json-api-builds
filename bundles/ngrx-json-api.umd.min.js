!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs/add/operator/let"),require("lodash/index"),require("rxjs/add/operator/finally"),require("@angular/common/http"),require("@ngrx/store"),require("@ngrx/effects"),require("rxjs/Observable"),require("rxjs/add/operator/map"),require("rxjs/add/observable/throw"),require("rxjs/add/observable/of"),require("rxjs/add/operator/catch"),require("rxjs/add/operator/concatAll"),require("rxjs/add/operator/do"),require("rxjs/add/operator/mapTo"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/switchMapTo"),require("rxjs/add/operator/take"),require("rxjs/add/operator/toArray"),require("rxjs/add/operator/withLatestFrom"),require("rxjs/add/observable/concat"),require("rxjs/add/operator/combineLatest"),require("rxjs/add/operator/concat"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/filter"),require("rxjs/add/observable/zip")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/add/operator/let","lodash/index","rxjs/add/operator/finally","@angular/common/http","@ngrx/store","@ngrx/effects","rxjs/Observable","rxjs/add/operator/map","rxjs/add/observable/throw","rxjs/add/observable/of","rxjs/add/operator/catch","rxjs/add/operator/concatAll","rxjs/add/operator/do","rxjs/add/operator/mapTo","rxjs/add/operator/mergeMap","rxjs/add/operator/switchMap","rxjs/add/operator/switchMapTo","rxjs/add/operator/take","rxjs/add/operator/toArray","rxjs/add/operator/withLatestFrom","rxjs/add/observable/concat","rxjs/add/operator/combineLatest","rxjs/add/operator/concat","rxjs/add/operator/concatMap","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/filter","rxjs/add/observable/zip"],r):r((e.ngrx=e.ngrx||{},e.ngrx.json=e.ngrx.json||{},e.ngrx.json.api={}),e.ng.core,null,e.lodash_index,null,e._angular_common_http,e._ngrx_store,e._ngrx_effects,e.Rx)}(this,function(e,r,t,n,i,a,o,s,u){"use strict";function p(e){var r=[];return Object.keys(e.data).forEach(function(t){Object.keys(e.data[t]).forEach(function(n){var i=e.data[t][n];"IN_SYNC"!==i.state&&"NEW"!==i.state&&r.push(i)})}),r}function d(e,r){void 0===e&&(e=Je);var t;switch(r.type){case E.API_POST_INIT:var n=pe(e.data,r.payload,!1,!0);return t=Object.assign({},e,{data:n,isCreating:e.isCreating+1});case E.API_GET_INIT:var i=r.payload;return t=Object.assign({},e,{queries:ce(e.queries,i),isReading:e.isReading+1});case E.API_PATCH_INIT:var n=pe(e.data,r.payload,!1,!1);return t=Object.assign({},e,{data:n,isUpdating:e.isUpdating+1});case E.API_DELETE_INIT:return t=Object.assign({},e,{data:ee(e.data,r.payload,"DELETED"),isDeleting:e.isDeleting+1});case E.API_POST_SUCCESS:return t=Object.assign({},e,{data:de(e.data,r.payload.jsonApiData),isCreating:e.isCreating-1});case E.API_GET_SUCCESS:return t=Object.assign({},e,{data:de(e.data,r.payload.jsonApiData),queries:fe(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case E.API_PATCH_SUCCESS:return t=Object.assign({},e,{data:de(e.data,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case E.API_DELETE_SUCCESS:return t=Object.assign({},e,{data:se(e.data,r.payload.query),queries:ne(e.queries,{id:r.payload.query.id,type:r.payload.query.type}),isDeleting:e.isDeleting-1});case E.API_QUERY_REFRESH:return t=Object.assign({},e,{queries:ue(e.queries,r.payload)});case E.API_POST_FAIL:return t=Object.assign({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isCreating:e.isCreating-1});case E.API_GET_FAIL:return t=Object.assign({},e,{queries:le(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case E.API_PATCH_FAIL:return t=Object.assign({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case E.API_DELETE_FAIL:return t=Object.assign({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isDeleting:e.isDeleting-1});case E.REMOVE_QUERY:var a=r.payload;return t=Object.assign({},e,{queries:ye(e.queries,a)});case E.LOCAL_QUERY_INIT:var i=r.payload;return t=Object.assign({},e,{queries:ce(e.queries,i)});case E.MODIFY_STORE_RESOURCE_ERRORS:var o=r.payload;return t=Object.assign({},e,{data:ae(e.data,o.resourceId,o.errors,o.modificationType)});case E.LOCAL_QUERY_SUCCESS:return t=Object.assign({},e,{queries:fe(e.queries,r.payload.query.queryId,r.payload.jsonApiData)});case E.PATCH_STORE_RESOURCE:var n=pe(e.data,r.payload,!1,!1);return n!==e.data?t=Object.assign({},e,{data:n}):e;case E.POST_STORE_RESOURCE:var n=pe(e.data,r.payload,!1,!0);return n!==e.data?t=Object.assign({},e,{data:n}):e;case E.NEW_STORE_RESOURCE:var n=pe(e.data,r.payload,!1,!0);return n=ee(n,r.payload,"NEW"),n!==e.data?t=Object.assign({},e,{data:n}):e;case E.DELETE_STORE_RESOURCE:var s=r.payload;if(e.data[s.type]&&e.data[s.type][s.id]){var u=e.data[s.type][s.id];return t="NEW"===u.state||"CREATED"===u.state?Object.assign({},e,{data:Z(e.data,s)}):Object.assign({},e,{data:ee(e.data,r.payload,"DELETED")})}return e;case E.API_APPLY_INIT:var c=p(e);t=Object.assign({},e,{isApplying:e.isApplying+1});for(var f=0,l=c;f<l.length;f++){var y=l[f];if("CREATED"===y.state)t.isCreating++;else if("UPDATED"===y.state)t.isUpdating++;else{if("DELETED"!==y.state)throw new Error("unknown state "+y.state);t.isDeleting++}}return t;case E.API_APPLY_SUCCESS:case E.API_APPLY_FAIL:var h=r.payload;t=e;for(var g=0,v=h;g<v.length;g++){t=d(t,v[g])}return t=Object.assign({},t,{isApplying:e.isApplying-1});case E.API_ROLLBACK:return t=Object.assign({},e,{data:oe(e.data)});case E.CLEAR_STORE:return Je;case E.COMPACT_STORE:return qe(e);default:return e}}function c(e,r){return new $e(e,r)}function f(e){return new Me(e)}function l(e,r){return new Ue(e,r)}function y(e){return[{provide:$e,useFactory:c,deps:[a.HttpClient,He]},{provide:Me,useFactory:f,deps:[He]},{provide:Ue,useFactory:l,deps:[o.Store,Me]},{provide:He,useValue:e}]}var h={};h.ASC=0,h.DESC=1,h[h.ASC]="ASC",h[h.DESC]="DESC";var E={API_POST_INIT:"[NgrxJsonApi] API_POST_INIT",API_POST_SUCCESS:"[NgrxJsonApi] API_POST_SUCCESS",API_POST_FAIL:"[NgrxJsonApi] API_POST_FAIL",API_GET_INIT:"[NgrxJsonApi] API_GET_INIT",API_GET_SUCCESS:"[NgrxJsonApi] API_GET_SUCCESS",API_GET_FAIL:"[NgrxJsonApi] API_GET_FAIL",API_PATCH_INIT:"[NgrxJsonApi] API_PATCH_INIT",API_PATCH_SUCCESS:"[NgrxJsonApi] API_PATCH_SUCCESS",API_PATCH_FAIL:"[NgrxJsonApi] API_PATCH_FAIL",API_DELETE_INIT:"[NgrxJsonApi] API_DELETE_INIT",API_DELETE_SUCCESS:"[NgrxJsonApi] API_DELETE_SUCCESS",API_DELETE_FAIL:"[NgrxJsonApi] API_DELETE_FAIL",API_APPLY_INIT:"[NgrxJsonApi] API_APPLY_INIT",API_APPLY_SUCCESS:"[NgrxJsonApi] API_APPLY_SUCCESS",API_APPLY_FAIL:"[NgrxJsonApi] API_APPLY_FAIL",API_ROLLBACK:"[NgrxJsonApi] API_ROLLBACK",API_QUERY_REFRESH:"[NgrxJsonApi] API_QUERY_REFRESH",LOCAL_QUERY_INIT:"[NgrxJsonApi] LOCAL_QUERY_INIT",LOCAL_QUERY_SUCCESS:"[NgrxJsonApi] LOCAL_QUERY_SUCCESS",LOCAL_QUERY_FAIL:"[NgrxJsonApi] LOCAL_QUERY_FAIL",DELETE_STORE_RESOURCE:"[NgrxJsonApi] DELETE_STORE_RESOURCE",PATCH_STORE_RESOURCE:"[NgrxJsonApi] PATCH_STORE_RESOURCE",NEW_STORE_RESOURCE:"[NgrxJsonApi] NEW_STORE_RESOURCE",POST_STORE_RESOURCE:"[NgrxJsonApi] POST_STORE_RESOURCE",MODIFY_STORE_RESOURCE_ERRORS:"[NgrxJsonApi] MODIFY_STORE_RESOURCE_ERRORS",REMOVE_QUERY:"[NgrxJsonApi] REMOVE_QUERY",COMPACT_STORE:"[NgrxJsonApi] COMPACT_STORE",CLEAR_STORE:"[NgrxJsonApi] CLEAR_STORE"},g=function(){function e(){this.type=E.API_APPLY_INIT}return e}(),v=function(){function e(e){this.payload=e,this.type=E.API_APPLY_SUCCESS}return e}(),A=function(){function e(e){this.payload=e,this.type=E.API_APPLY_FAIL}return e}(),_=function(){function e(e){this.payload=e,this.type=E.API_POST_INIT}return e}(),O=function(){function e(e){this.payload=e,this.type=E.API_POST_SUCCESS}return e}(),S=function(){function e(e){this.payload=e,this.type=E.API_POST_FAIL}return e}(),P=function(){function e(e){this.payload=e,this.type=E.API_DELETE_INIT}return e}(),I=function(){function e(e){this.payload=e,this.type=E.API_DELETE_SUCCESS}return e}(),R=function(){function e(e){this.payload=e,this.type=E.API_DELETE_FAIL}return e}(),T=function(){function e(e){this.payload=e,this.type=E.API_GET_INIT}return e}(),m=function(){function e(e){this.payload=e,this.type=E.API_GET_SUCCESS}return e}(),C=function(){function e(e){this.payload=e,this.type=E.API_GET_FAIL}return e}(),b=function(){function e(e){this.payload=e,this.type=E.API_PATCH_INIT}return e}(),j=function(){function e(e){this.payload=e,this.type=E.API_PATCH_SUCCESS}return e}(),q=function(){function e(e){this.payload=e,this.type=E.API_PATCH_FAIL}return e}(),w=function(){function e(e){this.payload=e,this.type=E.DELETE_STORE_RESOURCE}return e}(),L=function(){function e(e){this.payload=e,this.type=E.PATCH_STORE_RESOURCE}return e}(),U=function(){function e(e){this.payload=e,this.type=E.NEW_STORE_RESOURCE}return e}(),D=function(){function e(e){this.payload=e,this.type=E.POST_STORE_RESOURCE}return e}(),x=function(){function e(e){this.payload=e,this.type=E.REMOVE_QUERY}return e}(),N=function(){function e(e){this.payload=e,this.type=E.LOCAL_QUERY_INIT}return e}(),F=function(){function e(e){this.payload=e,this.type=E.LOCAL_QUERY_SUCCESS}return e}(),$=function(){function e(e){this.payload=e,this.type=E.LOCAL_QUERY_FAIL}return e}(),M=function(){function e(){this.type=E.COMPACT_STORE}return e}(),Q=function(){function e(){this.type=E.CLEAR_STORE}return e}(),J=function(){function e(e){if(this.payload=e,this.type=E.API_QUERY_REFRESH,!e)throw new Error("no query id provided for ApiQueryRefreshAction")}return e}(),Y=function(){function e(e){this.payload=e,this.type=E.MODIFY_STORE_RESOURCE_ERRORS}return e}(),H=function(e,r,t){var i=e;return e.hasOwnProperty("relationships")&&Object.keys(e.relationships).forEach(function(a){e.relationships[a].reference={};var o,s=e.relationships[a].data;if(null===s||n.isEqual(s,[]))o=s;else if(n.isPlainObject(s)){var u=W(s,r);o=G(u,r,t)}else if(n.isArray(s)){var p=B(s,r);o=p.map(function(e){return G(e,r,t)})}var d="relationships."+a+".reference";i=n.set(i,d,o)}),i},k=function(e,r,t){void 0===t&&(t={});for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i];n.push(G(o,r,t))}return n},G=function(e,r,t){if(void 0===t&&(t={}),!e)return null;var i=n.cloneDeep(e);return n.isUndefined(t[i.type])&&(t[i.type]={}),n.isUndefined(t[i.type][i.id])&&(t[i.type][i.id]=i,i=H(i,r,t),i.persistedResource&&(i.persistedResource=H(i.persistedResource,r,t))),t[i.type][i.id]},W=function(e,r){return n.get(r,[e.type,e.id],null)},B=function(e,r){return e.map(function(e){return W(e,r)})},V=function(e,r,t,i){var a=[];n.isUndefined(i)&&(i=".");for(var o=e.split(i),s=r,u=0;u<o.length;u++){var p=n.find(t,{type:s});if(n.isUndefined(p))throw new Error("Definition not found");if(n.isUndefined(p.attributes)&&n.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(o[u])){a.push("attributes",o[u]);break}if(!p.relationships.hasOwnProperty(o[u]))throw new Error("Cannot find field in attributes or relationships");var d=p.relationships[o[u]];if("hasMany"===d.relationType){if(u!==o.length-1)throw new Error("Cannot filter past a hasMany relation");a.push("relationships",o[u],"reference")}else s=d.type,a.push("relationships",o[u],"reference")}return a.join(i)},K=function(e,r,t,i){var a=V(e,r.type,t,i);return n.get(r,a)},z=function(e,r){function t(e,r){if(n.isArray(e))return r}return n.mergeWith({},e,r,t)},X=function(e,r,t){var i=Object.assign({},e);return i[r.id]=t?Object.assign({},r,{persistedResource:r,state:"IN_SYNC",errors:[],loading:!1}):Object.assign({},r,{persistedResource:null,state:"CREATED",errors:[],loading:!1}),n.isEqual(e,i)?e:i},Z=function(e,r){if(e[r.type][r.id]){var t=Object.assign({},e);return t[r.type]=Object.assign({},t[r.type]),delete t[r.type][r.id],t}return e},ee=function(e,r,t,i){if(n.isUndefined(e[r.type])||n.isUndefined(e[r.type][r.id])){if("DELETED"===t){var a=Object.assign({},e);return a[r.type]=Object.assign({},a[r.type]),a[r.type][r.id]=Object.assign({},a[r.type][r.id]),a[r.type][r.id]={type:r.type,id:r.id,persistedResource:null},a[r.type][r.id].state="NOT_LOADED",a}return e}var o=Object.assign({},e);return o[r.type]=Object.assign({},o[r.type]),o[r.type][r.id]=Object.assign({},o[r.type][r.id]),null!==t&&(o[r.type][r.id].state=t),null!=i&&(o[r.type][r.id].loading=i),o},re=function(e,r){return e===r||null!==e==(null!==r)&&(n.isEqual(e.id,r.id)&&n.isEqual(e.type,r.type)&&n.isEqual(e.attributes,r.attributes)&&n.isEqual(e.meta,r.meta)&&n.isEqual(e.links,r.links)&&n.isEqual(e.relationships,r.relationships))},te=function(e,r,t){var i,a,o=e[r.id],s=e[r.id].persistedResource;if(t)i=r,s=r,a="IN_SYNC";else{var u=z(o,r);re(u,s)?(i=s,a="IN_SYNC"):(i=u,a=null!==s?"UPDATED":"NEW"===o.state?"NEW":"CREATED")}var p=Object.assign({},e);return p[r.id]=Object.assign({},i,{persistedResource:s,state:a,errors:[],loading:!1}),n.isEqual(p[r.id],e[r.id])?e:p},ne=function(e,r){var t=e;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(i.query.id===r.id&&i.query.type===r.type){t=ue(t,i.query.queryId);var a={code:"404",status:"Not Found"};t[i.query.queryId].errors=[a]}}return t},ie=function(e,r,t){if(!r.type||!r.id||t.data instanceof Array)throw new Error("invalid parameters");return ae(e,{id:r.id,type:r.type},t.errors,"SET")},ae=function(e,r,t,i){if(!e[r.type]||!e[r.type][r.id])return e;var a=Object.assign({},e);a[r.type]=Object.assign({},a[r.type]);var o=Object.assign({},a[r.type][r.id]);if("SET"===i)o.errors=[],t&&(c=o.errors).push.apply(c,t);else if("ADD"===i){var s=o.errors;o.errors=[],s&&(f=o.errors).push.apply(f,s),t&&(l=o.errors).push.apply(l,t)}else{var s=o.errors;if(o.errors=[],s)for(var u=0,p=s;u<p.length;u++){var d=p[u];!function(e){t&&t.filter(function(r){return n.isEqual(r,e)}).length>0||o.errors.push(e)}(d)}}return a[r.type][r.id]=o,a;var c,f,l},oe=function(e){var r=Object.assign({},e);return Object.keys(r).forEach(function(e){r[e]=Object.assign({},r[e]),Object.keys(r[e]).forEach(function(t){var n=r[e][t];n.persistedResource?"IN_SYNC"!==n.state&&(r[e][t]=Object.assign({},r[e][t],{state:"IN_SYNC",resource:r[e][t].persistedResource})):delete r[e][t]})}),r},se=function(e,r){var t=Object.assign({},e);return void 0===r.id?t[r.type]={}:t[r.type]=n.omit(t[r.type],[r.id]),t},ue=function(e,r){var t=Object.assign({},e[r]);delete t.resultIds,delete t.errors,delete t.meta,delete t.links;var n=Object.assign({},e);return n[r]=t,n},pe=function(e,r,t,i){if(n.isUndefined(e[r.type])){var a=Object.assign({},e);return a[r.type]={},a[r.type]=X(a[r.type],r,t),a}if(n.isUndefined(e[r.type][r.id])||i){var o=X(e[r.type],r,t);if(o!==e[r.type]){var a=Object.assign({},e);return a[r.type]=o,a}return e}var o=te(e[r.type],r,t);if(o!==e[r.type]){var a=Object.assign({},e);return a[r.type]=o,a}return e},de=function(e,r){var t=n.get(r,"data");if(n.isUndefined(t))return e;t=n.isArray(t)?t:[t];var i=n.get(r,"included");return n.isUndefined(i)||(t=t.concat(i)),n.reduce(t,function(e,r){return pe(e,r,!0,!0)},e)},ce=function(e,r){if(!r.queryId)return e;var t=Object.assign({},e[r.queryId]);t.loading=!0,t.query=n.cloneDeep(r),n.isUndefined(t.errors)&&(t.errors=[]);var i=Object.assign({},e);return i[t.query.queryId]=t,i},fe=function(e,r,t){var i=e[r];if(i){var a=n.isArray(t.data)?t.data:[t.data],o=Object.assign({},i,{resultIds:a.map(function(e){return e?he(e):[]}),meta:t.meta,links:t.links,loading:!1}),s=Object.assign({},e);return s[r]=o,s}return e},le=function(e,r,t){if(!r||!e[r])return e;var n=Object.assign({},e),i=Object.assign({},n[r]);return i.errors=[],t.errors&&(a=i.errors).push.apply(a,t.errors),n[r]=i,n;var a},ye=function(e,r){var t=Object.assign({},e);return delete t[r],t},he=function(e){return{type:e.type,id:e.id}},Ee=function(e,r,t,i,a){n.isUndefined(a)&&(a=".");for(var o=e.split(a),s=r,u=0;u<o.length;u++){var p=n.find(i,{type:s.type});if(n.isUndefined(p))throw new Error("Definition not found");if(n.isUndefined(p.attributes)&&n.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(o[u]))return n.get(s,"attributes."+o[u],null);if(!p.relationships.hasOwnProperty(o[u]))throw new Error("Cannot find field in attributes or relationships");if(u===o.length-1)throw new Error("The last field in the filtering path cannot be a relation");var d=p.relationships[o[u]];if("hasMany"===d.relationType)throw new Error("Cannot filter past a hasMany relation");var c=n.get(s,"relationships."+o[u],null);if(!c||!c.data)return null;var f=[d.type,c.data.id];if(s=n.get(t,f),n.isUndefined(s))return null}},ge=function(e,r,t,i,a){return n.filter(e,function(e){return!t.hasOwnProperty("params")||!t.params.hasOwnProperty("filtering")||t.params.filtering.every(function(t){var o,s;n.isUndefined(a)||(o=n.get(a,"pathSeparator"),s=n.get(a,"filteringOperators"));var u=Ee(t.path,e,r,i,o);if(!u)return!1;var p=n.find(s,{name:t.operator});if(p)return p.comparison(t.value,u);switch(t.operator=t.hasOwnProperty("operator")?t.operator:"iexact",t.operator){case"iexact":return n.isString(t.value)&&n.isString(u)?t.value.toLowerCase()===u.toLowerCase():t.value===u;case"exact":return t.value===u;case"contains":return n.includes(u,t.value);case"icontains":return n.includes(u.toLowerCase(),t.value.toLowerCase());case"in":return n.isArray(t.value)?n.includes(t.value,u):n.includes([t.value],u);case"gt":return t.value>u;case"gte":return t.value>=u;case"lt":return t.value<u;case"lte":return t.value<=u;case"startswith":return n.startsWith(u,t.value);case"istartswith":return n.startsWith(u.toLowerCase(),t.value.toLowerCase());case"endswith":return n.endsWith(u,t.value);case"iendswith":return n.endsWith(u.toLowerCase(),t.value.toLowerCase());default:return!0}})})},ve=function(e){return n.isEmpty(e)?"":"include="+e.join()},Ae=function(e){return n.isEmpty(e)?"":"fields="+e.join()},_e=function(e){return n.isEmpty(e)?"":e.map(function(e){return"filter["+e.path+"]"+(e.operator?"["+e.operator+"]":"")+"="+encodeURIComponent(e.value)}).join("&")},Oe=function(e){return n.isEmpty(e)?"":"sort="+e.map(function(e){return(e.direction===h.ASC?"":"-")+e.api}).join(",")},Se=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e.filter(function(e){return""!==e});return 0!==t.length?"?"+t.join("&"):""},Pe=function(e,r){var t={query:{type:e.type}};return"POST"!==r&&"PATCH"!==r||(t.jsonApiData={data:{id:e.id,type:e.type,attributes:e.attributes,relationships:e.relationships}}),"POST"===r&&e.hasTemporaryId&&delete t.jsonApiData.data.id,"PATCH"!==r&&"DELETE"!==r&&"POST"!==r||(t.query.id=e.id),t},Ie=function(){for(var e=[],r=0;r<256;r++)e[r]=(r<16?"0":"")+r.toString(16);var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&a]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]},Re=function(e){return e.id+"@"+e.type},Te=function(e,r){for(var t in e.queries)if(e.queries.hasOwnProperty(t)){var n=e.queries[t];if(n.resultIds)for(var i=0,a=n.resultIds;i<a.length;i++){var o=a[i];r[Re(o)]=!0}}},me=function(e,r){for(var t in e.data)if(e.data.hasOwnProperty(t)){var n=e.data[t];for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];"IN_SYNC"!==a.state&&(r[Re(a)]=!0)}}},Ce=function(e,r,t){var n;for(var i in t.relationships)if(t.relationships.hasOwnProperty(i)){var a=t.relationships[i].data;if(a)for(var o=a instanceof Array?a:[a],s=0,u=o;s<u.length;s++){var p=u[s],d=Re(p);r[d]||(n=!0,r[d]=!0)}}return n},be=function(e,r){for(;;){var t=!1;for(var n in e.data)if(e.data.hasOwnProperty(n)){var i=e.data[n];for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];r[Re(o)]&&(t=t||Ce(0,r,o))}}if(!t)break}},je=function(e,r){var t=!1,i=n.cloneDeep(e);for(var a in i.data)if(i.data.hasOwnProperty(a)){var o=i.data[a];for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];r[Re(u)]||(t=!0,delete o[s])}n.isEmpty(o)&&delete i.data[a]}return t?i:e},qe=function(e){var r={};return Te(e,r),me(e,r),be(e,r),je(e,r)},we=function(e){for(var r={},t={},n=0,i=e;n<i.length;n++){var a=i[n],o=a,s=Re(o);r[s]=[],t[s]=a}for(var u=0,p=e;u<p.length;u++){var a=p[u];!function(e){var n=e;if(n.relationships){var i=Re(n);Object.keys(n.relationships).forEach(function(e){var a=n.relationships[e].data;if(a)for(var o=a instanceof Array?a:[a],s=0,u=o;s<u.length;s++){var p=u[s],d=Re(p);t[d]&&"CREATED"===t[d].state&&r[i].push(t[d])}})}}(a)}for(var d={pendingResources:e,cursor:e.length,sorted:new Array(e.length),dependencies:r,visited:[]},c=d.cursor;c--;)d.visited[c]||Le(e[c],c,[],d);return d.sorted},Le=function(e,r,t,n){var i=Re(e);if(t.indexOf(i)>=0)throw new Error("Cyclic dependency: "+i+" with "+JSON.stringify(t));if(!n.visited[r]){n.visited[r]=!0;for(var a=n.dependencies[i],o=t.concat(i),s=0,u=a;s<u.length;s++){var p=u[s];Le(p,n.pendingResources.indexOf(p),o,n)}n.sorted[--n.cursor]=e}},Ue=function(){function e(e,r){var t=this;this.store=e,this.selectors=r,this.test=!0,this.store.let(this.selectors.getNgrxJsonApiStore$()).subscribe(function(e){return t.storeSnapshot=e})}return e.prototype.findOne=function(e){return this.findInternal(e,!1)},e.prototype.findMany=function(e){return this.findInternal(e,!0)},e.prototype.putQuery=function(e){var r=e.query,t=!!n.isUndefined(e.fromServer)||e.fromServer;if(!r.queryId)throw new Error("to query must have a queryId");t?this.store.dispatch(new T(r)):this.store.dispatch(new N(r))},e.prototype.refreshQuery=function(e){this.store.dispatch(new J(e))},e.prototype.removeQuery=function(e){this.store.dispatch(new x(e))},e.prototype.findInternal=function(e,r){var t,i=this,a=e.query,o=!!n.isUndefined(e.fromServer)||e.fromServer,s=!n.isUndefined(e.denormalise)&&e.denormalise;t=a.queryId?a:Object.assign({},a,{queryId:this.uuid()}),this.putQuery({query:t,fromServer:o});var u;return u=r?this.selectManyResults(t.queryId,s):this.selectOneResults(t.queryId,s),u.finally(function(){return i.removeQuery(t.queryId)})},e.prototype.uuid=function(){return Ie()},e.prototype.getPersistedResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id].persistedResource:null},e.prototype.getResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id]:null},e.prototype.selectManyResults=function(e,r){return void 0===r&&(r=!1),this.store.let(this.selectors.getNgrxJsonApiStore$()).let(this.selectors.getManyResults$(e,r))},e.prototype.selectOneResults=function(e,r){return void 0===r&&(r=!1),this.store.let(this.selectors.getNgrxJsonApiStore$()).let(this.selectors.getOneResult$(e,r))},e.prototype.selectStoreResource=function(e){return this.store.let(this.selectors.getStoreResource$(e))},e.prototype.denormaliseResource=function(e){return e.combineLatest(this.store.let(this.selectors.getNgrxJsonApiStore$()).let(this.selectors.getStoreData$()),function(e,r){return n.isArray(e)?k(e,r):G(e,r)})},e.prototype.getDenormalisedPath=function(e,r){var t=n.get(this.selectors.config,"filteringConfig.pathSeparator");return V(e,r,this.selectors.config.resourceDefinitions,t)},e.prototype.getDenormalisedValue=function(e,r){var t=n.get(this.selectors.config,"filteringConfig.pathSeparator");return K(e,r,this.selectors.config.resourceDefinitions,t)},e.prototype.patchResource=function(e){var r=e.resource;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new b(r)):this.store.dispatch(new L(r))},e.prototype.newResource=function(e){var r=e.resource;this.store.dispatch(new U(r))},e.prototype.postResource=function(e){var r=e.resource;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new _(r)):this.store.dispatch(new D(r))},e.prototype.deleteResource=function(e){var r=e.resourceId;!n.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new P(r)):this.store.dispatch(new w(r))},e.prototype.apply=function(){this.store.dispatch(new g)},e.prototype.clear=function(){this.store.dispatch(new Q)},e.prototype.compact=function(){this.store.dispatch(new M)},e.prototype.addResourceErrors=function(e,r){this.store.dispatch(new Y({resourceId:e,errors:r,modificationType:"ADD"}))},e.prototype.removeResourceErrors=function(e,r){this.store.dispatch(new Y({resourceId:e,errors:r,modificationType:"REMOVE"}))},e.prototype.setResourceErrors=function(e,r){this.store.dispatch(new Y({resourceId:e,errors:r,modificationType:"SET"}))},e}(),De=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.selectStoreResource(e)},e}();De.decorators=[{type:r.Pipe,args:[{name:"jaSelectStoreResource"}]}],De.ctorParameters=function(){return[{type:Ue}]};var xe=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.denormaliseResource(e)},e}();xe.decorators=[{type:r.Pipe,args:[{name:"denormaliseStoreResource"}]}],xe.ctorParameters=function(){return[{type:Ue}]};var Ne=function(){function e(e){this.service=e}return e.prototype.transform=function(e,r){return this.service.getDenormalisedValue(e,r)},e}();Ne.decorators=[{type:r.Pipe,args:[{name:"getDenormalisedValue"}]}],Ne.ctorParameters=function(){return[{type:Ue}]};var Fe=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&(t[n[i]]=e[n[i]]);return t},$e=function(){function e(e,r){this.http=e,this.config=r,this.headers=new a.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}),this.definitions=this.config.resourceDefinitions}return e.prototype.urlBuilder=function(e,r){switch(r){case"GET":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);if(e.type)return this.collectionUrlFor(e.type);case"DELETE":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"PATCH":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"POST":return this.collectionUrlFor(e.type)}},e.prototype.collectionPathFor=function(e){var r=n.find(this.definitions,{type:e});return r?""+r.collectionPath:e},e.prototype.collectionUrlFor=function(e){var r=this.collectionPathFor(e);return this.config.apiUrl+"/"+r},e.prototype.resourcePathFor=function(e,r){return this.collectionPathFor(e)+"/"+encodeURIComponent(r)},e.prototype.resourceUrlFor=function(e,r){var t=this.resourcePathFor(e,r);return this.config.apiUrl+"/"+t},e.prototype.find=function(e){var r=ve,t=_e,i=Ae,a=Oe,o=Se;if(this.config.hasOwnProperty("urlBuilder")){var s=this.config.urlBuilder;s.generateIncludedQueryParams&&(r=s.generateIncludedQueryParams),s.generateFilteringQueryParams&&(t=s.generateFilteringQueryParams),s.generateFieldsQueryParams&&(i=s.generateFieldsQueryParams),s.generateSortingQueryParams&&(a=s.generateSortingQueryParams),s.generateQueryParams&&(o=s.generateQueryParams)}var p="",d="",c="",f="",l="",y="",h="";if(void 0===typeof e)return u.Observable.throw("Query not found");e.hasOwnProperty("params")&&!n.isEmpty(e.params)&&(n.hasIn(e.params,"include")&&(d=r(e.params.include)),n.hasIn(e.params,"filtering")&&(c=t(e.params.filtering)),n.hasIn(e.params,"sorting")&&(f=a(e.params.sorting)),n.hasIn(e.params,"fields")&&(l=i(e.params.fields)),n.hasIn(e.params,"limit")&&(h="page[limit]="+e.params.limit),n.hasIn(e.params,"offset")&&(y="page[offset]="+e.params.offset)),p=o(d,c,f,l,y,h);var E={method:"GET",url:this.urlBuilder(e,"GET")+p};return this.request(E)},e.prototype.create=function(e,r){if(void 0===typeof e)return u.Observable.throw("Query not found");if(void 0===typeof r)return u.Observable.throw("Data not found");var t={method:"POST",url:this.urlBuilder(e,"POST"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.update=function(e,r){if(void 0===typeof e)return u.Observable.throw("Query not found");if(void 0===typeof r)return u.Observable.throw("Data not found");var t={method:"PATCH",url:this.urlBuilder(e,"PATCH"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.delete=function(e){if(void 0===typeof e)return u.Observable.throw("Query not found");var r={method:"DELETE",url:this.urlBuilder(e,"DELETE")};return this.request(r)},e.prototype.request=function(e){var r,t=Object.assign({},e,{headers:this.headers,observe:"response"});if("GET"===e.method){var n=t.method,i=t.url,o=Fe(t,["method","url"]);r=new a.HttpRequest(n,i,o)}else if("POST"===e.method){var n=t.method,i=t.url,s=t.body,o=Fe(t,["method","url","body"]);r=new a.HttpRequest(n,i,s,o)}else if("PATCH"===e.method){var n=t.method,i=t.url,s=t.body,o=Fe(t,["method","url","body"]);r=new a.HttpRequest(n,i,s,o)}else if("DELETE"===e.method){var n=t.method,i=t.url,o=Fe(t,["method","url"]);r=new a.HttpRequest(n,i,o)}return this.http.request(r)},e}(),Me=function(){function e(e){this.config=e}return e.prototype.getNgrxJsonApiStore$=function(){return function(e){return e.select("NgrxJsonApi").select("api")}},e.prototype.getStoreData$=function(){return function(e){return e.select("data")}},e.prototype.getStoreResourceOfType$=function(e){var r=this;return function(t){return t.let(r.getStoreData$()).map(function(r){return r?r[e]:void 0})}},e.prototype.queryStore$=function(e){var r=this;return function(t){var n;return e.type?(n=e.type&&e.id?t.let(r.getStoreResource$({type:e.type,id:e.id})):t.let(r.getStoreResourceOfType$(e.type)).combineLatest(t.let(r.getStoreData$()),function(t,n){return ge(t,n,e,r.config.resourceDefinitions,r.config.filteringConfig)}),n.distinctUntilChanged()):t.map(function(){return u.Observable.throw("Unknown query")})}},e.prototype.getStoreQueries$=function(){return function(e){return e.select("queries")}},e.prototype.getResourceQuery$=function(e){var r=this;return function(t){return t.let(r.getStoreQueries$()).map(function(r){return r?r[e]:void 0})}},e.prototype.getStoreResource$=function(e){var r=this;return function(t){return t.let(r.getStoreResourceOfType$(e.type)).map(function(r){return r?r[e.id]:void 0})}},e.prototype.getManyResults$=function(e,r){return function(t){return t.map(function(t){var i=t.queries[e];if(i){if(n.isEmpty(i.resultIds)){return Object.assign({},i,{data:n.isUndefined(i.resultIds)?void 0:[]})}var a=i.resultIds.map(function(e){return t.data[e.type]?t.data[e.type][e.id]:void 0});return r&&(a=k(a,t.data)),Object.assign({},i,{data:a})}})}},e.prototype.getOneResult$=function(e,r){return function(t){return t.map(function(t){var i=t.queries[e];if(i){if(n.isEmpty(i.resultIds)){return Object.assign({},i,{data:n.isUndefined(i.resultIds)?void 0:null})}if(i.resultIds.length>=2)throw new Error("expected single result for query "+i.query.queryId);var a=i.resultIds[0],o=t.data[a.type]?t.data[a.type][a.id]:void 0;return r&&(o=G(o,t.data)),Object.assign({},i,{data:o})}})}},e.prototype.getPersistedResource$=function(e,r){var t=this;return function(e){return e.let(t.getStoreResource$(r)).map(function(e){return e?e.persistedResource:void 0})}},e}(),Qe=function(){function e(e,r,t,i){var a=this;this.actions$=e,this.jsonApi=r,this.store=t,this.selectors=i,this.createResource$=this.actions$.ofType(E.API_POST_INIT).map(function(e){return a.generatePayload(e.payload,"POST")}).mergeMap(function(e){return a.jsonApi.create(e.query,e.jsonApiData).mapTo(new O(e)).catch(function(r){return u.Observable.of(new S(a.toErrorPayload(e.query,r)))})}),this.updateResource$=this.actions$.ofType(E.API_PATCH_INIT).map(function(e){return a.generatePayload(e.payload,"PATCH")}).mergeMap(function(e){return a.jsonApi.update(e.query,e.jsonApiData).mapTo(new j(e)).catch(function(r){return u.Observable.of(new q(a.toErrorPayload(e.query,r)))})}),this.readResource$=this.actions$.ofType(E.API_GET_INIT).map(function(e){return e.payload}).mergeMap(function(e){return a.jsonApi.find(e).map(function(e){return e.body}).map(function(r){return new m({jsonApiData:r,query:e})}).catch(function(r){return u.Observable.of(new C(a.toErrorPayload(e,r)))})}),
this.queryStore$=this.actions$.ofType(E.LOCAL_QUERY_INIT).map(function(e){return e.payload}).mergeMap(function(e){return a.store.let(a.selectors.getNgrxJsonApiStore$()).let(a.selectors.queryStore$(e)).map(function(r){return new F({jsonApiData:{data:r},query:e})}).catch(function(r){return u.Observable.of(new $(a.toErrorPayload(e,r)))})}),this.deleteResource$=this.actions$.ofType(E.API_DELETE_INIT).map(function(e){return e.payload}).map(function(e){return a.generatePayload(e,"DELETE")}).mergeMap(function(e){return a.jsonApi.delete(e.query).map(function(e){return e.body}).map(function(r){return new I({jsonApiData:r,query:e.query})}).catch(function(r){return u.Observable.of(new R(a.toErrorPayload(e.query,r)))})}),this.triggerReadOnQueryRefresh$=this.actions$.ofType(E.API_QUERY_REFRESH).withLatestFrom(this.store,function(e,r){var t=e.payload,n=r.NgrxJsonApi.api,i=n.queries[t].query;return new T(i)}),this.refreshQueriesOnDelete$=this.actions$.ofType(E.API_DELETE_SUCCESS).withLatestFrom(this.store,function(e,r){var t={id:e.payload.query.id,type:e.payload.query.type};if(!t.id||!t.type)throw new Error("API_DELETE_SUCCESS did not carry resource id and type information");var i=r.NgrxJsonApi.api,a=[];for(var o in i.queries)if(i.queries.hasOwnProperty(o)){var s=i.queries[o];if(s.resultIds){var u=-1!==n.findIndex(s.resultIds,function(e){return n.isEqual(t,e)}),p=s.query.id===t.id&&s.query.type===t.type;if(p&&(u||n.isEmpty(s.errors)))throw new Error("store is in invalid state, queries for deleted resource should have been emptied and marked with 404 error");u&&a.push(new J(o))}}return a}).flatMap(function(e){return u.Observable.of.apply(u.Observable,e)}),this.applyResources$=this.actions$.ofType(E.API_APPLY_INIT).mergeMap(function(){return a.store.let(a.selectors.getNgrxJsonApiStore$()).take(1)}).mergeMap(function(e){var r=p(e);if(r.length>0){r=we(r);for(var t=[],n=0,i=r;n<i.length;n++){var o=i[n];!function(e){if("CREATED"===e.state){var r=a.generatePayload(e,"POST");t.push(a.jsonApi.create(r.query,r.jsonApiData).mapTo(new O(r)).catch(function(e){return u.Observable.of(new S(a.toErrorPayload(r.query,e)))}))}else if("UPDATED"===e.state){var n=a.generatePayload(e,"PATCH");t.push(a.jsonApi.update(n.query,n.jsonApiData).map(function(e){return new j({jsonApiData:e,query:n.query})}).catch(function(e){return u.Observable.of(new q(a.toErrorPayload(n.query,e)))}))}else{if("DELETED"!==e.state)throw new Error("unknown state "+e.state);var i=a.generatePayload(e,"DELETE");t.push(a.jsonApi.delete(i.query).map(function(e){return new I({jsonApiData:e,query:i.query})}).catch(function(e){return u.Observable.of(new R(a.toErrorPayload(i.query,e)))}))}}(o)}return u.Observable.of.apply(u.Observable,t).concatAll().toArray().map(function(e){return a.toApplyAction(e)})}return u.Observable.of(new v([]))})}return e.prototype.ngOnDestroy=function(){},e.prototype.toApplyAction=function(e){for(var r=0,t=e;r<t.length;r++){var n=t[r];if(n.type===E.API_POST_FAIL||n.type===E.API_PATCH_FAIL||n.type===E.API_DELETE_FAIL)return new A(e)}return new v(e)},e.prototype.toErrorPayload=function(e,r){var t=null;r&&r.headers&&(t=r.headers.get("Content-Type"));var n=null;if("application/vnd.api+json"===t&&(n=r),n&&n.errors&&n.errors.length>0)return{query:e,jsonApiData:n};var i=[],a={status:String(r.status),code:r.statusText};return i.push(a),{query:e,jsonApiData:{errors:i}}},e.prototype.generatePayload=function(e,r){return Pe(e,r)},e}();Qe.decorators=[{type:r.Injectable}],Qe.ctorParameters=function(){return[{type:s.Actions},{type:$e},{type:o.Store},{type:Me}]},Qe.propDecorators={createResource$:[{type:s.Effect}],updateResource$:[{type:s.Effect}],readResource$:[{type:s.Effect}],queryStore$:[{type:s.Effect}],deleteResource$:[{type:s.Effect}],triggerReadOnQueryRefresh$:[{type:s.Effect}],refreshQueriesOnDelete$:[{type:s.Effect}],applyResources$:[{type:s.Effect}]};var Je={isCreating:0,isReading:0,isUpdating:0,isDeleting:0,isApplying:0,data:{},queries:{}},Ye={api:d},He=new r.OpaqueToken("NGRX_JSON_API_CONFIG"),ke=function(){function e(){}return e.configure=function(r){return{ngModule:e,providers:y(r)}},e}();ke.decorators=[{type:r.NgModule,args:[{declarations:[xe,Ne,De],imports:[s.EffectsModule.forFeature([Qe]),o.StoreModule.forFeature("NgrxJsonApi",Ye,{})],exports:[xe,Ne,De]}]}],ke.ctorParameters=function(){return[]},e.SelectStoreResourcePipe=De,e.DenormaliseStoreResourcePipe=xe,e.GetDenormalisedValuePipe=Ne,e.NgrxJsonApiService=Ue,e.NgrxJsonApiModule=ke,e.Direction=h,e.ɵh=$e,e.ɵg=Qe,e.ɵa=He,e.ɵb=c,e.ɵe=y,e.ɵc=f,e.ɵd=l,e.ɵi=d,e.ɵj=Ye,e.ɵf=Me,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/bundles/ngrx-json-api.umd.min.js.map