!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("lodash"),require("rxjs/add/observable/concat"),require("rxjs/add/observable/throw"),require("rxjs/add/operator/combineLatest"),require("rxjs/add/operator/concat"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/do"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/let"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/observable/zip"),require("rxjs/operators"),require("@ngrx/store"),require("rxjs/add/operator/finally"),require("@angular/core"),require("@angular/common/http"),require("rxjs/Observable"),require("@ngrx/effects"),require("rxjs/observable/of"),require("rxjs/add/operator/concatAll")):"function"==typeof define&&define.amd?define(["exports","lodash","rxjs/add/observable/concat","rxjs/add/observable/throw","rxjs/add/operator/combineLatest","rxjs/add/operator/concat","rxjs/add/operator/concatMap","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/do","rxjs/add/operator/filter","rxjs/add/operator/let","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/observable/zip","rxjs/operators","@ngrx/store","rxjs/add/operator/finally","@angular/core","@angular/common/http","rxjs/Observable","@ngrx/effects","rxjs/observable/of","rxjs/add/operator/concatAll"],r):r((e.ngrx=e.ngrx||{},e.ngrx.json=e.ngrx.json||{},e.ngrx.json.api={}),e.lodash,null,null,null,null,null,null,null,null,null,null,null,null,e.operators,e.store,null,e.ng.core,e.http,e.Rx,e.effects,e.Rx.Observable)}(this,function(e,r,t,n,o,i,a,s,u,p,d,c,f,l,y,h,E,v,A,I,g,_){"use strict";function P(e,t,n){return n===r.get(e,t)?e:r.setWith(r.clone(e),t,n,function(e,t,n){var o=r.clone(n);return o[t]=e,o})}function S(e,r,t){var n=e[r][t];n.persistedResource?"IN_SYNC"!==n.state&&(e[r][t]=$({},e[r][t],{state:"IN_SYNC",resource:e[r][t].persistedResource})):delete e[r][t]}function R(e,t,n,o,i){var a=e[n.type][n.id];"IN_SYNC"===a.state||"NEW"===a.state&&!i||t.push(a);for(var s=0,u=o;s<u.length;s++){var p=u[s];!function(n){if(n.length>0){var s=n[0];if(a.relationships&&a.relationships[s]){var u=a.relationships[s].data;if(u){var p=[];if(o.filter(function(e){return e.length>=2&&e[0]==s}).forEach(function(e){return p.push(e.slice(1))}),r.isArray(u)){u.forEach(function(r){return R(e,t,r,p,i)})}else{R(e,t,u,p,i)}}}}}(p)}}function O(e,t,n,o){var i=[];if(r.isUndefined(t))Object.keys(e).forEach(function(r){Object.keys(e[r]).forEach(function(t){var n=e[r][t];"IN_SYNC"===n.state||"NEW"===n.state&&!o||i.push(n)})});else{var a=[];if(n)for(var s=0,u=n;s<u.length;s++){var p=u[s];a.push(p.split("."))}for(var d=0,c=t;d<c.length;d++){var f=c[d];R(e,i,f,a,o)}i=r.uniqBy(i,function(e){return e.type+"####"+e.id})}return i}function T(){return function(e){return e.pipe(h.select("NgrxJsonApi"),y.map(function(e){return e}),y.filter(function(e){return!r.isUndefined(e)}))}}function C(){return m(Y)}function m(e){return function(r){return r.let(T()).map(function(r){return r.zones[e]})}}function q(e,r){return e.NgrxJsonApi.zones[r]}function w(e){return function(r){return r.map(function(r){return r.queries[e]})}}function L(e){return function(r){return r.map(function(e){return e.data}).map(function(r){return r?r[e]:void 0})}}function U(e){return function(r){return r.let(L(e.type)).map(function(r){return r?r[e.id]:void 0})}}function b(e,t){return function(n){return n.map(function(n){var o=n.queries[e];if(o){if(r.isEmpty(o.resultIds)){return Ne({},o,{data:r.isUndefined(o.resultIds)?void 0:[]})}var i=o.resultIds.map(function(e){return n.data[e.type]?n.data[e.type][e.id]:void 0});return t&&(i=G(i,n.data)),Ne({},o,{data:i})}})}}function D(e,t){return function(n){return n.map(function(n){var o=n.queries[e];if(o){if(r.isEmpty(o.resultIds)){var i=Ne({},o,{data:r.isUndefined(o.resultIds)?void 0:null});return i}if(o.resultIds.length>=2)throw new Error("expected single result for query "+o.query.queryId);var a=o.resultIds[0],s=n.data[a.type]?n.data[a.type][a.id]:void 0;t&&(s=k(s,n.data));var i=Ne({},o,{data:s});return i}})}}function N(e){return e.let(C())}function j(e,r){void 0===e&&(e=qr);var t=r.zoneId;if(!t)return e;var n=e.zones[t];n||(n=mr);var o=x(n,r);return n!=o?Cr({},e,{zones:Cr({},e.zones,(i={},i[t]=o,i))}):e;var i}function x(e,r){var t;switch(r.type){case ze.API_POST_INIT:var n=de(e.data,r.payload,!1,!0);return t=Cr({},e,{data:n,isCreating:e.isCreating+1});case ze.API_GET_INIT:var o=r.payload;return t=Cr({},e,{queries:fe(e.queries,o),isReading:e.isReading+1});case ze.API_PATCH_INIT:var n=de(e.data,r.payload,!1,!1);return t=Cr({},e,{data:n,isUpdating:e.isUpdating+1});case ze.API_DELETE_INIT:return t=Cr({},e,{data:re(e.data,r.payload,"DELETED"),isDeleting:e.isDeleting+1});case ze.API_POST_SUCCESS:return t=Cr({},e,{data:ce(e.data,r.payload.jsonApiData),isCreating:e.isCreating-1});case ze.API_GET_SUCCESS:return t=Cr({},e,{data:ce(e.data,r.payload.jsonApiData),queries:le(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case ze.API_PATCH_SUCCESS:return t=Cr({},e,{data:ce(e.data,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case ze.API_DELETE_SUCCESS:return t=Cr({},e,{data:ue(e.data,r.payload.query),queries:oe(e.queries,{id:r.payload.query.id,type:r.payload.query.type}),isDeleting:e.isDeleting-1});case ze.API_QUERY_REFRESH:return t=Cr({},e,{queries:pe(e.queries,r.payload)});case ze.API_POST_FAIL:return t=Cr({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isCreating:e.isCreating-1});case ze.API_GET_FAIL:return t=Cr({},e,{queries:ye(e.queries,r.payload.query.queryId,r.payload.jsonApiData),isReading:e.isReading-1});case ze.API_PATCH_FAIL:return t=Cr({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isUpdating:e.isUpdating-1});case ze.API_DELETE_FAIL:return t=Cr({},e,{data:ie(e.data,r.payload.query,r.payload.jsonApiData),isDeleting:e.isDeleting-1});case ze.REMOVE_QUERY:var i=r.payload;return t=Cr({},e,{queries:he(e.queries,i)});case ze.LOCAL_QUERY_INIT:var o=r.payload;return t=Cr({},e,{queries:fe(e.queries,o)});case ze.MODIFY_STORE_RESOURCE_ERRORS:var a=r.payload;return t=Cr({},e,{data:ae(e.data,a.resourceId,a.errors,a.modificationType)});case ze.LOCAL_QUERY_SUCCESS:return P(e,"queries",le(e.queries,r.payload.query.queryId,r.payload.jsonApiData));case ze.PATCH_STORE_RESOURCE:var n=de(e.data,r.payload,!1,!1);return n!==e.data?t=Cr({},e,{data:n}):e;case ze.POST_STORE_RESOURCE:var n=de(e.data,r.payload,!1,!0);return n!==e.data?t=Cr({},e,{data:n}):e;case ze.NEW_STORE_RESOURCE:var n=de(e.data,r.payload,!1,!0);return n=re(n,r.payload,"NEW"),n!==e.data?t=Cr({},e,{data:n}):e;case ze.DELETE_STORE_RESOURCE:var s=r.payload;if(e.data[s.type]&&e.data[s.type][s.id]){var u=e.data[s.type][s.id];return t="NEW"===u.state||"CREATED"===u.state?Cr({},e,{data:ee(e.data,s)}):Cr({},e,{data:re(e.data,r.payload,"DELETED")})}return e;case ze.API_APPLY_INIT:var a=r.payload,p=O(e.data,a.ids,a.include);t=Cr({},e,{isApplying:e.isApplying+1});for(var d=0,c=p;d<c.length;d++){var f=c[d];if("CREATED"===f.state)t.isCreating++;else if("UPDATED"===f.state)t.isUpdating++;else{if("DELETED"!==f.state)throw new Error("unknown state "+f.state);t.isDeleting++}}return t;case ze.API_APPLY_SUCCESS:case ze.API_APPLY_FAIL:var l=r.payload;t=e;for(var y=0,h=l;y<h.length;y++){t=x(t,h[y])}return t=Cr({},t,{isApplying:e.isApplying-1});case ze.API_ROLLBACK:var a=r.payload;return t=Cr({},e,{data:se(e.data,a.ids,a.include)});case ze.CLEAR_STORE:return mr;case ze.COMPACT_STORE:return Ue(e);default:return e}}function z(e,r){return new Sr(e,r)}function F(){return new je}function Q(e,r){return new vr(e,r)}function J(e){return[{provide:Sr,useFactory:z,deps:[A.HttpClient,Lr]},{provide:je,useFactory:F},{provide:vr,useFactory:Q,deps:[h.Store,Lr]},{provide:Lr,useValue:e}]}var Y="default",M={ASC:0,DESC:1};M[M.ASC]="ASC",M[M.DESC]="DESC";var $=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},H=function(e,t,n,o){return void 0===o&&(o=!1),e.hasOwnProperty("relationships")&&Object.keys(e.relationships).forEach(function(i){var a=e.relationships[i],s=a.data;if(!r.isUndefined(s)){var u=void 0;if(null===s)u=s;else if(r.isArray(s))if(0==s.length)u=s;else{var p=B(s,t);u=p.map(function(e){return k(e,t,n,o)})}else{var d=W(s,t);u=k(d,t,n,o)}var c=$({},a);c.reference=u,e.relationships[i]=c}}),e},G=function(e,r,t,n){void 0===t&&(t={}),void 0===n&&(n=!1);for(var o=[],i=0,a=e;i<a.length;i++){var s=a[i];o.push(k(s,r,t,n))}return o},k=function(e,t,n,o){if(void 0===n&&(n={}),void 0===o&&(o=!1),!e)return null;if(r.isUndefined(n[e.type])&&(n[e.type]={}),r.isUndefined(n[e.type][e.id])){var i=$({},e);e.relationships&&(i.relationships=$({},e.relationships)),n[i.type][i.id]=i,i=H(i,t,n,o),i.persistedResource&&o&&(i.persistedResource=H(i.persistedResource,t,n,o))}return n[e.type][e.id]},W=function(e,t){return r.get(t,[e.type,e.id],null)},B=function(e,r){return e.map(function(e){return W(e,r)})},V=function(e,t,n,o){var i=[];r.isUndefined(o)&&(o=".");for(var a=e.split(o),s=t,u=0;u<a.length;u++){var p=r.find(n,{type:s});if(r.isUndefined(p))throw new Error("Definition not found");if(r.isUndefined(p.attributes)&&r.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(a[u])){i.push("attributes",a[u]);break}if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");var d=p.relationships[a[u]];if("hasMany"===d.relationType){if(u!==a.length-1)throw new Error("Cannot filter past a hasMany relation");i.push("relationships",a[u],"reference")}else s=d.type,i.push("relationships",a[u],"reference")}return i.join(o)},Z=function(e,t,n,o){var i=V(e,t.type,n,o);return r.get(t,i)},K=function(e,t){function n(e,t){if(r.isArray(e))return t}return r.mergeWith({},e,t,n)},X=function(e,t,n){var o=$({},e);return o[t.id]=n?$({},t,{persistedResource:t,state:"IN_SYNC",errors:[],loading:!1}):$({},t,{persistedResource:null,state:"CREATED",errors:[],loading:!1}),r.isEqual(e,o)?e:o},ee=function(e,r){if(e[r.type][r.id]){var t=$({},e);return t[r.type]=$({},t[r.type]),delete t[r.type][r.id],t}return e},re=function(e,t,n,o){if(r.isUndefined(e[t.type])||r.isUndefined(e[t.type][t.id])){if("DELETED"===n){var i=$({},e);return i[t.type]=$({},i[t.type]),i[t.type][t.id]=$({},i[t.type][t.id]),i[t.type][t.id]={type:t.type,id:t.id,persistedResource:null},i[t.type][t.id].state="NOT_LOADED",i}return e}var a=$({},e);return a[t.type]=$({},a[t.type]),a[t.type][t.id]=$({},a[t.type][t.id]),null!==n&&(a[t.type][t.id].state=n),null!=o&&(a[t.type][t.id].loading=o),a},te=function(e,t){return e===t||null!==e==(null!==t)&&(r.isEqual(e.id,t.id)&&r.isEqual(e.type,t.type)&&r.isEqual(e.attributes,t.attributes)&&r.isEqual(e.meta,t.meta)&&r.isEqual(e.links,t.links)&&r.isEqual(e.relationships,t.relationships))},ne=function(e,t,n){var o,i,a=e[t.id],s=e[t.id].persistedResource;if(n)o=t,s=t,i="IN_SYNC";else{var u=K(a,t);te(u,s)?(o=s,i="IN_SYNC"):(o=u,i=null!==s?"UPDATED":"NEW"===a.state?"NEW":"CREATED")}var p=$({},e);return p[t.id]=$({},o,{persistedResource:s,state:i,errors:[],loading:!1}),r.isEqual(p[t.id],e[t.id])?e:p},oe=function(e,r){var t=e;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if(o.query.id===r.id&&o.query.type===r.type){t=pe(t,o.query.queryId);var i={code:"404",status:"Not Found"};t[o.query.queryId].errors=[i]}}return t},ie=function(e,r,t){if(!r.type||!r.id||t.data instanceof Array)throw new Error("invalid parameters");return ae(e,{id:r.id,type:r.type},t.errors,"SET")},ae=function(e,t,n,o){if(!e[t.type]||!e[t.type][t.id])return e;var i=$({},e);i[t.type]=$({},i[t.type]);var a=$({},i[t.type][t.id]);if("SET"===o)a.errors=[],n&&(c=a.errors).push.apply(c,n);else if("ADD"===o){var s=a.errors;a.errors=[],s&&(f=a.errors).push.apply(f,s),n&&(l=a.errors).push.apply(l,n)}else{var s=a.errors;if(a.errors=[],s)for(var u=0,p=s;u<p.length;u++){var d=p[u];!function(e){n&&n.filter(function(t){return r.isEqual(t,e)}).length>0||a.errors.push(e)}(d)}}return i[t.type][t.id]=a,i;var c,f,l},se=function(e,t,n){var o=$({},e);if(r.isUndefined(t))Object.keys(o).forEach(function(e){o[e]=$({},o[e]),Object.keys(o[e]).forEach(function(r){S(o,e,r)})});else for(var i=O(o,t,n,!0),a=0,s=i;a<s.length;a++){var u=s[a];S(o,u.type,u.id)}return o},ue=function(e,t){var n=$({},e);return void 0===t.id?n[t.type]={}:n[t.type]=r.omit(n[t.type],[t.id]),n},pe=function(e,r){var t=$({},e[r]);delete t.resultIds,delete t.errors,delete t.meta,delete t.links;var n=$({},e);return n[r]=t,n},de=function(e,t,n,o){if(r.isUndefined(e[t.type])){var i=$({},e);return i[t.type]={},i[t.type]=X(i[t.type],t,n),i}if(r.isUndefined(e[t.type][t.id])||o){var a=X(e[t.type],t,n);if(a!==e[t.type]){var i=$({},e);return i[t.type]=a,i}return e}var a=ne(e[t.type],t,n);if(a!==e[t.type]){var i=$({},e);return i[t.type]=a,i}return e},ce=function(e,t){var n=r.get(t,"data");if(r.isUndefined(n))return e;var o=r.isArray(n)?n:[n],i=r.get(t,"included");r.isUndefined(i)||(o=o.concat(i));for(var a=$({},e),s=!1,u=0,p=o;u<p.length;u++){var d=p[u],c=$({},d,{persistedResource:d,state:"IN_SYNC",errors:[],loading:!1});r.isEqual(c,d)||(s=!0,a[d.type]?a[d.type]===e[d.type]&&(a[d.type]=$({},e[d.type])):a[d.type]={},a[d.type][d.id]=c)}return s?a:e},fe=function(e,t){if(!t.queryId)return e;var n=$({},e[t.queryId]);n.loading=!0,n.query=r.cloneDeep(t),r.isUndefined(n.errors)&&(n.errors=[]);var o=$({},e);return o[n.query.queryId]=n,o},le=function(e,t,n){var o=e[t];if(o){var i=r.isArray(n.data)?n.data:[n.data],a=$({},o,{resultIds:i.map(function(e){return e?Ee(e):[]}),meta:n.meta,links:n.links,loading:!1});if(!r.isEqual(a,o)){var s=$({},e);return s[t]=a,s}}return e},ye=function(e,r,t){if(!r||!e[r])return e;var n=$({},e),o=$({},n[r]);return o.errors=[],o.loading=!1,t.errors&&(i=o.errors).push.apply(i,t.errors),n[r]=o,n;var i},he=function(e,r){var t=$({},e);return delete t[r],t},Ee=function(e){return{type:e.type,id:e.id}},ve=function(e,t,n,o,i){r.isUndefined(i)&&(i=".");for(var a=e.split(i),s=t,u=0;u<a.length;u++){var p=r.find(o,{type:s.type});if(r.isUndefined(p))throw new Error("Definition not found");if(r.isUndefined(p.attributes)&&r.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if("id"===a[u])return r.get(s,"id",null);if(p.attributes.hasOwnProperty(a[u]))return r.get(s,"attributes."+a[u],null);if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");if(u===a.length-1)throw new Error("The last field in the filtering path cannot be a relation");var d=p.relationships[a[u]];if("hasMany"===d.relationType)throw new Error("Cannot filter past a hasMany relation");var c=r.get(s,"relationships."+a[u],null);if(!c||!c.data)return null;var f=[d.type,c.data.id];if(s=r.get(n,f),r.isUndefined(s))return null}},Ae=function(e,t,n,o,i){return r.filter(e,function(e){return!n.hasOwnProperty("params")||!n.params.hasOwnProperty("filtering")||n.params.filtering.every(function(n){var a,s;r.isUndefined(i)||(a=r.get(i,"pathSeparator"),s=r.get(i,"filteringOperators"));var u=ve(n.path,e,t,o,a);if(!u)return!1;var p=r.find(s,{name:n.operator});if(p)return p.comparison(n.value,u);switch(n.operator=n.hasOwnProperty("operator")?n.operator:"iexact",n.operator){case"iexact":return r.isString(n.value)&&r.isString(u)?n.value.toLowerCase()===u.toLowerCase():n.value===u;case"exact":return n.value===u;case"contains":return r.includes(u,n.value);case"icontains":return r.includes(u.toLowerCase(),n.value.toLowerCase());case"in":return r.isArray(n.value)?r.includes(n.value,u):r.includes([n.value],u);case"gt":return n.value>u;case"gte":return n.value>=u;case"lt":return n.value<u;case"lte":return n.value<=u;case"startswith":return r.startsWith(u,n.value);case"istartswith":return r.startsWith(u.toLowerCase(),n.value.toLowerCase());case"endswith":return r.endsWith(u,n.value);case"iendswith":return r.endsWith(u.toLowerCase(),n.value.toLowerCase());default:return!0}})})},Ie=function(e){return r.isEmpty(e)?"":"include="+e.join()},ge=function(e){return r.isEmpty(e)?"":"fields="+e.join()},_e=function(e){return r.isEmpty(e)?"":e.map(function(e){return"filter["+e.path+"]"+(e.operator?"["+e.operator+"]":"")+"="+encodeURIComponent(e.value)}).join("&")},Pe=function(e){return r.isEmpty(e)?"":"sort="+e.map(function(e){return(e.direction===M.ASC?"":"-")+e.api}).join(",")},Se=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e.filter(function(e){return""!==e});return 0!==t.length?"?"+t.join("&"):""},Re=function(e,r){var t={query:{type:e.type}};return"POST"!==r&&"PATCH"!==r||(t.jsonApiData={data:{id:e.id,type:e.type,attributes:e.attributes,relationships:e.relationships}}),"POST"===r&&e.hasTemporaryId&&delete t.jsonApiData.data.id,"PATCH"!==r&&"DELETE"!==r&&"POST"!==r||(t.query.id=e.id),t},Oe=function(){for(var e=[],r=0;r<256;r++)e[r]=(r<16?"0":"")+r.toString(16);var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&o|128]+e[o>>8&255]+"-"+e[o>>16&255]+e[o>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]},Te=function(e){return e.id+"@"+e.type},Ce=function(e,r){for(var t in e.queries)if(e.queries.hasOwnProperty(t)){var n=e.queries[t];if(n.resultIds)for(var o=0,i=n.resultIds;o<i.length;o++){var a=i[o];r[Te(a)]=!0}}},me=function(e,r){for(var t in e.data)if(e.data.hasOwnProperty(t)){var n=e.data[t];for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];"IN_SYNC"!==i.state&&(r[Te(i)]=!0)}}},qe=function(e,r,t){var n;for(var o in t.relationships)if(t.relationships.hasOwnProperty(o)){var i=t.relationships[o].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],d=Te(p);r[d]||(n=!0,r[d]=!0)}}return n},we=function(e,r){for(;;){var t=!1;for(var n in e.data)if(e.data.hasOwnProperty(n)){var o=e.data[n];for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];r[Te(a)]&&(t=t||qe(0,r,a))}}if(!t)break}},Le=function(e,t){var n=!1,o=r.cloneDeep(e);for(var i in o.data)if(o.data.hasOwnProperty(i)){var a=o.data[i];for(var s in a)if(a.hasOwnProperty(s)){var u=a[s];t[Te(u)]||(n=!0,delete a[s])}r.isEmpty(a)&&delete o.data[i]}return n?o:e},Ue=function(e){var r={};return Ce(e,r),me(e,r),we(e,r),Le(e,r)},be=function(e){for(var r={},t={},n=0,o=e;n<o.length;n++){var i=o[n],a=i,s=Te(a);r[s]=[],t[s]=i}for(var u=0,p=e;u<p.length;u++){var i=p[u];!function(e){var n=e;if(n.relationships){var o=Te(n);Object.keys(n.relationships).forEach(function(e){var i=n.relationships[e].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],d=Te(p);t[d]&&"CREATED"===t[d].state&&r[o].push(t[d])}})}}(i)}for(var d={pendingResources:e,cursor:e.length,sorted:new Array(e.length),dependencies:r,visited:[]},c=d.cursor;c--;)d.visited[c]||De(e[c],c,[],d);return d.sorted},De=function(e,r,t,n){var o=Te(e);if(t.indexOf(o)>=0)throw new Error("Cyclic dependency: "+o+" with "+JSON.stringify(t));if(!n.visited[r]){n.visited[r]=!0;for(var i=n.dependencies[o],a=t.concat(o),s=0,u=i;s<u.length;s++){var p=u[s];De(p,n.pendingResources.indexOf(p),a,n)}n.sorted[--n.cursor]=e}},Ne=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},je=function(){function e(){}return e.prototype.getNgrxJsonApiStore$=function(){return function(e){return e.let(C())}},e.prototype.getStoreData$=function(){return function(e){return e.select("data")}},e.prototype.getStoreResourceOfType$=function(e){var r=this;return function(t){return t.let(r.getStoreData$()).map(function(r){return r?r[e]:void 0})}},e.prototype.getStoreQueries$=function(){return function(e){return e.select("queries")}},e.prototype.getResourceQuery$=function(e){return w(e)},e.prototype.getStoreResource$=function(e){return U(e)},e.prototype.getManyResults$=function(e,r){return b(e,r)},e.prototype.getOneResult$=function(e,r){return D(e,r)},e.prototype.getPersistedResource$=function(e){var r=this;return function(t){return t.let(r.getStoreResource$(e)).map(function(e){return e?e.persistedResource:void 0})}},e}(),xe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),ze={API_POST_INIT:"[NgrxJsonApi] API_POST_INIT",API_POST_SUCCESS:"[NgrxJsonApi] API_POST_SUCCESS",API_POST_FAIL:"[NgrxJsonApi] API_POST_FAIL",API_GET_INIT:"[NgrxJsonApi] API_GET_INIT",API_GET_SUCCESS:"[NgrxJsonApi] API_GET_SUCCESS",API_GET_FAIL:"[NgrxJsonApi] API_GET_FAIL",API_PATCH_INIT:"[NgrxJsonApi] API_PATCH_INIT",API_PATCH_SUCCESS:"[NgrxJsonApi] API_PATCH_SUCCESS",API_PATCH_FAIL:"[NgrxJsonApi] API_PATCH_FAIL",API_DELETE_INIT:"[NgrxJsonApi] API_DELETE_INIT",API_DELETE_SUCCESS:"[NgrxJsonApi] API_DELETE_SUCCESS",API_DELETE_FAIL:"[NgrxJsonApi] API_DELETE_FAIL",API_APPLY_INIT:"[NgrxJsonApi] API_APPLY_INIT",API_APPLY_SUCCESS:"[NgrxJsonApi] API_APPLY_SUCCESS",API_APPLY_FAIL:"[NgrxJsonApi] API_APPLY_FAIL",API_ROLLBACK:"[NgrxJsonApi] API_ROLLBACK",API_QUERY_REFRESH:"[NgrxJsonApi] API_QUERY_REFRESH",LOCAL_QUERY_INIT:"[NgrxJsonApi] LOCAL_QUERY_INIT",LOCAL_QUERY_SUCCESS:"[NgrxJsonApi] LOCAL_QUERY_SUCCESS",LOCAL_QUERY_FAIL:"[NgrxJsonApi] LOCAL_QUERY_FAIL",DELETE_STORE_RESOURCE:"[NgrxJsonApi] DELETE_STORE_RESOURCE",PATCH_STORE_RESOURCE:"[NgrxJsonApi] PATCH_STORE_RESOURCE",NEW_STORE_RESOURCE:"[NgrxJsonApi] NEW_STORE_RESOURCE",POST_STORE_RESOURCE:"[NgrxJsonApi] POST_STORE_RESOURCE",MODIFY_STORE_RESOURCE_ERRORS:"[NgrxJsonApi] MODIFY_STORE_RESOURCE_ERRORS",REMOVE_QUERY:"[NgrxJsonApi] REMOVE_QUERY",COMPACT_STORE:"[NgrxJsonApi] COMPACT_STORE",CLEAR_STORE:"[NgrxJsonApi] CLEAR_STORE"},Fe=function(){function e(){}return e}(),Qe=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_APPLY_INIT,n}return xe(r,e),r}(Fe),Je=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_APPLY_SUCCESS,n}return xe(r,e),r}(Fe),Ye=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_APPLY_FAIL,n}return xe(r,e),r}(Fe),Me=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_POST_INIT,n}return xe(r,e),r}(Fe),$e=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_POST_SUCCESS,n}return xe(r,e),r}(Fe),He=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_POST_FAIL,n}return xe(r,e),r}(Fe),Ge=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_DELETE_INIT,n}return xe(r,e),r}(Fe),ke=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_DELETE_SUCCESS,n}return xe(r,e),r}(Fe),We=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_DELETE_FAIL,n}return xe(r,e),r}(Fe),Be=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_GET_INIT,n}return xe(r,e),r}(Fe),Ve=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_GET_SUCCESS,n}return xe(r,e),r}(Fe),Ze=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_GET_FAIL,n}return xe(r,e),r}(Fe),Ke=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_ROLLBACK,n}return xe(r,e),r}(Fe),Xe=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_PATCH_INIT,n}return xe(r,e),r}(Fe),er=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_PATCH_SUCCESS,n}return xe(r,e),r}(Fe),rr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.API_PATCH_FAIL,n}return xe(r,e),r}(Fe),tr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.DELETE_STORE_RESOURCE,n}return xe(r,e),r}(Fe),nr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.PATCH_STORE_RESOURCE,n}return xe(r,e),r}(Fe),or=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.NEW_STORE_RESOURCE,n}return xe(r,e),r}(Fe),ir=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.POST_STORE_RESOURCE,n}return xe(r,e),r}(Fe),ar=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.REMOVE_QUERY,n}return xe(r,e),r}(Fe),sr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.LOCAL_QUERY_INIT,n}return xe(r,e),r}(Fe),ur=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.LOCAL_QUERY_SUCCESS,n}return xe(r,e),r}(Fe),pr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.LOCAL_QUERY_FAIL,n}return xe(r,e),r}(Fe),dr=function(e){function r(r){var t=e.call(this)||this;return t.zoneId=r,t.type=ze.COMPACT_STORE,t}return xe(r,e),r}(Fe),cr=function(e){function r(r){var t=e.call(this)||this;return t.zoneId=r,t.type=ze.CLEAR_STORE,t}return xe(r,e),r}(Fe),fr=function(e){function r(r,t){var n=e.call(this)||this;if(n.payload=r,n.zoneId=t,n.type=ze.API_QUERY_REFRESH,!r)throw new Error("no query id provided for ApiQueryRefreshAction");return n}return xe(r,e),r}(Fe),lr=function(e){function r(r,t){var n=e.call(this)||this;return n.payload=r,n.zoneId=t,n.type=ze.MODIFY_STORE_RESOURCE_ERRORS,n}return xe(r,e),r}(Fe),yr=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),hr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Er=function(){function e(e,r){this.zoneId=e,this.store=r}return e.prototype.putQuery=function(e){var t=e.query,n=!!r.isUndefined(e.fromServer)||e.fromServer;if(!t.queryId)throw new Error("to query must have a queryId");n?this.store.dispatch(new Be(t,this.zoneId)):this.store.dispatch(new sr(t,this.zoneId))},e.prototype.refreshQuery=function(e){this.store.dispatch(new fr(e,this.zoneId))},e.prototype.removeQuery=function(e){this.store.dispatch(new ar(e,this.zoneId))},e.prototype.selectManyResults=function(e,r){return void 0===r&&(r=!1),this.store.let(m(this.zoneId)).let(b(e,r))},e.prototype.selectOneResults=function(e,r){return void 0===r&&(r=!1),this.store.let(m(this.zoneId)).let(D(e,r))},e.prototype.selectStoreResource=function(e){return this.store.let(m(this.zoneId)).let(U(e))},e.prototype.patchResource=function(e){var t=e.resource;!r.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new Xe(t,this.zoneId)):this.store.dispatch(new nr(t,this.zoneId))},e.prototype.newResource=function(e){var r=e.resource;this.store.dispatch(new or(r,this.zoneId))},e.prototype.postResource=function(e){var t=e.resource;!r.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new Me(t,this.zoneId)):this.store.dispatch(new ir(t,this.zoneId))},e.prototype.deleteResource=function(e){var t=e.resourceId;!r.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new Ge(t,this.zoneId)):this.store.dispatch(new tr(t,this.zoneId))},e.prototype.apply=function(){this.store.dispatch(new Qe({},this.zoneId))},e.prototype.clear=function(){this.store.dispatch(new cr(this.zoneId))},e.prototype.compact=function(){this.store.dispatch(new dr(this.zoneId))},e.prototype.addResourceErrors=function(e,r){this.store.dispatch(new lr({resourceId:e,errors:r,modificationType:"ADD"},this.zoneId))},e.prototype.removeResourceErrors=function(e,r){this.store.dispatch(new lr({resourceId:e,errors:r,modificationType:"REMOVE"},this.zoneId))},e.prototype.setResourceErrors=function(e,r){this.store.dispatch(new lr({resourceId:e,errors:r,modificationType:"SET"},this.zoneId))},e}(),vr=function(e){function t(r,t){var n=e.call(this,Y,r)||this;return n.config=t,n.test=!0,n}return yr(t,e),t.prototype.getDefaultZone=function(){return this},t.prototype.getZone=function(e){return new Er(e,this.store)},t.prototype.findOne=function(e){return this.findInternal(e,!1)},t.prototype.findMany=function(e){return this.findInternal(e,!0)},Object.defineProperty(t.prototype,"storeSnapshot",{get:function(){var e=this;if(!this._storeSnapshot&&(this.store.let(C()).subscribe(function(r){return e._storeSnapshot=r}),!this._storeSnapshot))throw new Error("failed to initialize store snapshot");return this._storeSnapshot},enumerable:!0,configurable:!0}),t.prototype.findInternal=function(e,t){var n,o=this,i=e.query,a=!!r.isUndefined(e.fromServer)||e.fromServer,s=!r.isUndefined(e.denormalise)&&e.denormalise;n=i.queryId?i:hr({},i,{queryId:this.uuid()}),this.putQuery({query:n,fromServer:a});var u;return u=t?this.selectManyResults(n.queryId,s):this.selectOneResults(n.queryId,s),u.finally(function(){return o.removeQuery(n.queryId)})},t.prototype.uuid=function(){return Oe()},t.prototype.getPersistedResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id].persistedResource:null},t.prototype.getResourceSnapshot=function(e){var r=this.storeSnapshot;return r.data[e.type]&&r.data[e.type][e.id]?r.data[e.type][e.id]:null},t.prototype.denormaliseResource=function(e){return e.combineLatest(this.store.let(m(this.zoneId)).map(function(e){return e.data}),function(e,t){return r.isArray(e)?G(e,t):k(e,t)})},t.prototype.getDenormalisedPath=function(e,t){var n=r.get(this.config,"filteringConfig.pathSeparator");return V(e,t,this.config.resourceDefinitions,n)},t.prototype.getDenormalisedValue=function(e,t){var n=r.get(this.config,"filteringConfig.pathSeparator");return Z(e,t,this.config.resourceDefinitions,n)},t}(Er),Ar=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.selectStoreResource(e)},e.decorators=[{type:v.Pipe,args:[{name:"jaSelectStoreResource"}]}],e.ctorParameters=function(){return[{type:vr}]},e}(),Ir=function(){function e(e){this.service=e}return e.prototype.transform=function(e){return this.service.denormaliseResource(e)},e.decorators=[{type:v.Pipe,args:[{name:"denormaliseStoreResource"}]}],e.ctorParameters=function(){return[{type:vr}]},e}(),gr=function(){function e(e){this.service=e}return e.prototype.transform=function(e,r){return this.service.getDenormalisedValue(e,r)},e.decorators=[{type:v.Pipe,args:[{name:"getDenormalisedValue"}]}],e.ctorParameters=function(){return[{type:vr}]},e}(),_r=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Pr=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&(t[n[o]]=e[n[o]]);return t},Sr=function(){function e(e,t){if(this.http=e,this.config=t,this.headers=new A.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}),this.definitions=this.config.resourceDefinitions,this.config.requestHeaders)for(var n=0,o=r.keys(this.config.requestHeaders);n<o.length;n++){var i=o[n],a=this.config.requestHeaders[i];this.headers=this.headers.set(i,a)}}return e.prototype.urlBuilder=function(e,r){switch(r){case"GET":
if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);if(e.type)return this.collectionUrlFor(e.type);case"DELETE":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"PATCH":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"POST":return this.collectionUrlFor(e.type)}},e.prototype.collectionPathFor=function(e){var t=r.find(this.definitions,{type:e});return t?""+t.collectionPath:e},e.prototype.collectionUrlFor=function(e){var r=this.collectionPathFor(e);return this.config.apiUrl+"/"+r},e.prototype.resourcePathFor=function(e,r){return this.collectionPathFor(e)+"/"+encodeURIComponent(r)},e.prototype.resourceUrlFor=function(e,r){var t=this.resourcePathFor(e,r);return this.config.apiUrl+"/"+t},e.prototype.find=function(e){var t=Ie,n=_e,o=ge,i=Pe,a=Se;if(this.config.hasOwnProperty("urlBuilder")){var s=this.config.urlBuilder;s.generateIncludedQueryParams&&(t=s.generateIncludedQueryParams),s.generateFilteringQueryParams&&(n=s.generateFilteringQueryParams),s.generateFieldsQueryParams&&(o=s.generateFieldsQueryParams),s.generateSortingQueryParams&&(i=s.generateSortingQueryParams),s.generateQueryParams&&(a=s.generateQueryParams)}var u="",p="",d="",c="",f="",l="",y="";if(void 0===typeof e)return I.Observable.throw("Query not found");e.hasOwnProperty("params")&&!r.isEmpty(e.params)&&(r.hasIn(e.params,"include")&&(p=t(e.params.include)),r.hasIn(e.params,"filtering")&&(d=n(e.params.filtering)),r.hasIn(e.params,"sorting")&&(c=i(e.params.sorting)),r.hasIn(e.params,"fields")&&(f=o(e.params.fields)),r.hasIn(e.params,"limit")&&(y="page[limit]="+e.params.limit),r.hasIn(e.params,"offset")&&(l="page[offset]="+e.params.offset)),u=a(p,d,c,f,l,y);var h={method:"GET",url:this.urlBuilder(e,"GET")+u};return this.request(h)},e.prototype.create=function(e,r){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof r)return I.Observable.throw("Data not found");var t={method:"POST",url:this.urlBuilder(e,"POST"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.update=function(e,r){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof r)return I.Observable.throw("Data not found");var t={method:"PATCH",url:this.urlBuilder(e,"PATCH"),body:JSON.stringify({data:r.data})};return this.request(t)},e.prototype.delete=function(e){if(void 0===typeof e)return I.Observable.throw("Query not found");var r={method:"DELETE",url:this.urlBuilder(e,"DELETE")};return this.request(r)},e.prototype.request=function(e){var r=_r({},e,{headers:this.headers,observe:"response"});if("GET"===e.method){var t=(r.method,r.url),n=Pr(r,["method","url"]);return this.http.get(t,n)}if("POST"===e.method){var t=(r.method,r.url),o=r.body,n=Pr(r,["method","url","body"]);return this.http.post(t,o,n)}if("PATCH"===e.method){var t=(r.method,r.url),o=r.body,n=Pr(r,["method","url","body"]);return this.http.patch(t,o,n)}if("DELETE"===e.method){var t=(r.method,r.url),n=Pr(r,["method","url"]);return this.http.delete(t,n)}},e}(),Rr=function(e,r,t,n){var o,i=arguments.length,a=i<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,r,t,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(r,t,a):o(r,t))||a);return i>3&&a&&Object.defineProperty(r,t,a),a},Or=function(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)},Tr=function(){function e(e,t,n){var o=this;this.actions$=e,this.jsonApi=t,this.store=n,this.createResource$=this.actions$.pipe(g.ofType(ze.API_POST_INIT),y.mergeMap(function(e){var r=o.generatePayload(e.payload,"POST");return o.jsonApi.create(r.query,r.jsonApiData).pipe(y.map(function(t){return new $e({jsonApiData:t.body,query:r.query},e.zoneId)}),y.catchError(function(t){return _.of(new He(o.toErrorPayload(r.query,t),e.zoneId))}))})),this.updateResource$=this.actions$.pipe(g.ofType(ze.API_PATCH_INIT),y.mergeMap(function(e){var r=o.generatePayload(e.payload,"PATCH");return o.jsonApi.update(r.query,r.jsonApiData).pipe(y.map(function(t){return new er({jsonApiData:t.body,query:r.query},e.zoneId)}),y.catchError(function(t){return _.of(new rr(o.toErrorPayload(r.query,t),e.zoneId))}))})),this.readResource$=this.actions$.pipe(g.ofType(ze.API_GET_INIT),y.mergeMap(function(e){var r=e.payload;return o.jsonApi.find(r).pipe(y.map(function(e){return e.body}),y.map(function(t){return new Ve({jsonApiData:t,query:r},e.zoneId)}),y.catchError(function(t){return _.of(new Ze(o.toErrorPayload(r,t),e.zoneId))}))})),this.queryStore$=this.actions$.pipe(g.ofType(ze.LOCAL_QUERY_INIT),y.mergeMap(function(e){var r=e.payload;return o.store.let(m(e.zoneId)).let(o.executeLocalQuery(r)).pipe(y.map(function(t){return new ur({jsonApiData:{data:t},query:r},e.zoneId)}),y.catchError(function(t){return _.of(new pr(o.toErrorPayload(r,t),e.zoneId))}),y.takeUntil(o.localQueryInitEventFor(r)),y.takeUntil(o.removeQueryEventFor(r)))})),this.deleteResource$=this.actions$.pipe(g.ofType(ze.API_DELETE_INIT),y.mergeMap(function(e){var r=o.generatePayload(e.payload,"DELETE");return o.jsonApi.delete(r.query).pipe(y.map(function(e){return e.body}),y.map(function(t){return new ke({jsonApiData:t,query:r.query},e.zoneId)}),y.catchError(function(t){return _.of(new We(o.toErrorPayload(r.query,t),e.zoneId))}))})),this.triggerReadOnQueryRefresh$=this.actions$.pipe(g.ofType(ze.API_QUERY_REFRESH),y.withLatestFrom(this.store,function(e,r){var t=e.payload,n=q(r,e.zoneId),o=n.queries[t].query;return new Be(o,e.zoneId)})),this.refreshQueriesOnDelete$=this.actions$.pipe(g.ofType(ze.API_DELETE_SUCCESS),y.withLatestFrom(this.store,function(e,t){var n={id:e.payload.query.id,type:e.payload.query.type};if(!n.id||!n.type)throw new Error("API_DELETE_SUCCESS did not carry resource id and type information");var o=q(t,e.zoneId),i=[];for(var a in o.queries)if(o.queries.hasOwnProperty(a)){var s=o.queries[a];if(s.resultIds){var u=-1!==r.findIndex(s.resultIds,function(e){return r.isEqual(n,e)}),p=s.query.id===n.id&&s.query.type===n.type;if(p&&(u||r.isEmpty(s.errors)))throw new Error("store is in invalid state, queries for deleted resource should have been emptied and marked with 404 error");u&&i.push(new fr(a,e.zoneId))}}return i}),y.flatMap(function(e){return _.of.apply(void 0,e)})),this.applyResources$=this.actions$.pipe(g.ofType(ze.API_APPLY_INIT),y.filter(function(){return!1!==o.jsonApi.config.applyEnabled}),y.withLatestFrom(this.store,function(e,r){var t=q(r,e.zoneId),n=e.payload,i=O(t.data,n.ids,n.include);if(0===i.length)return _.of(new Je([],e.zoneId));for(var a=be(i),s=[],u=0,p=a;u<p.length;u++){var d=p[u];if("CREATED"===d.state)s.push(o.handlePendingCreate(d,e.zoneId));else if("UPDATED"===d.state)s.push(o.handlePendingUpdate(d,e.zoneId));else{if("DELETED"!==d.state)throw new Error("unknown state "+d.state);s.push(o.handlePendingDelete(d,e.zoneId))}}return _.of.apply(void 0,s).concatAll().pipe(y.toArray(),y.map(function(r){return o.toApplyAction(r,e.zoneId)}))}),y.flatMap(function(e){return e})),this.config=this.jsonApi.config}return e.prototype.localQueryInitEventFor=function(e){return this.actions$.pipe(g.ofType(ze.LOCAL_QUERY_INIT),y.map(function(e){return e}),y.filter(function(r){return e.queryId==r.payload.queryId}))},e.prototype.removeQueryEventFor=function(e){return this.actions$.pipe(g.ofType(ze.REMOVE_QUERY),y.map(function(e){return e}),y.filter(function(r){return e.queryId==r.payload}))},e.prototype.executeLocalQuery=function(e){var r=this;return function(t){var n;return e.type?(n=e.type&&e.id?t.let(U({type:e.type,id:e.id})):t.let(L(e.type)).pipe(y.combineLatest(t.map(function(e){return e.data}),function(t,n){return Ae(t,n,e,r.config.resourceDefinitions,r.config.filteringConfig)})),n.distinctUntilChanged()):t.map(function(){return I.Observable.throw("Unknown query")})}},e.prototype.handlePendingCreate=function(e,r){var t=this,n=this.generatePayload(e,"POST");return this.jsonApi.create(n.query,n.jsonApiData).pipe(y.map(function(e){return new $e({jsonApiData:e.body,query:n.query},r)}),y.catchError(function(e){return _.of(new He(t.toErrorPayload(n.query,e),r))}))},e.prototype.handlePendingUpdate=function(e,r){var t=this,n=this.generatePayload(e,"PATCH");return this.jsonApi.update(n.query,n.jsonApiData).pipe(y.map(function(e){return new er({jsonApiData:e.body,query:n.query},r)}),y.catchError(function(e){return _.of(new rr(t.toErrorPayload(n.query,e),r))}))},e.prototype.handlePendingDelete=function(e,r){var t=this,n=this.generatePayload(e,"DELETE");return this.jsonApi.delete(n.query).pipe(y.map(function(e){return new ke({jsonApiData:e.body,query:n.query},r)}),y.catchError(function(e){return _.of(new We(t.toErrorPayload(n.query,e),r))}))},e.prototype.ngOnDestroy=function(){},e.prototype.toApplyAction=function(e,r){for(var t=0,n=e;t<n.length;t++){var o=n[t];if(o.type===ze.API_POST_FAIL||o.type===ze.API_PATCH_FAIL||o.type===ze.API_DELETE_FAIL)return new Ye(e,r)}return new Je(e,r)},e.prototype.toErrorPayload=function(e,r){var t=null;r&&r.headers&&(t=r.headers.get("Content-Type"));var n=null;if(null!=t&&t.startsWith("application/vnd.api+json")&&(n=r),n&&n.error&&n.error.errors&&n.error.errors.length>0)return{query:e,jsonApiData:n.error};var o=[],i={status:String(r.status),code:r.statusText};return o.push(i),{query:e,jsonApiData:{errors:o}}},e.prototype.generatePayload=function(e,r){return Re(e,r)},e.decorators=[{type:v.Injectable}],e.ctorParameters=function(){return[{type:g.Actions},{type:Sr},{type:h.Store}]},Rr([g.Effect(),Or("design:type",I.Observable)],e.prototype,"createResource$",void 0),Rr([g.Effect(),Or("design:type",I.Observable)],e.prototype,"updateResource$",void 0),Rr([g.Effect(),Or("design:type",I.Observable)],e.prototype,"readResource$",void 0),Rr([g.Effect(),Or("design:type",Object)],e.prototype,"queryStore$",void 0),Rr([g.Effect(),Or("design:type",Object)],e.prototype,"deleteResource$",void 0),Rr([g.Effect(),Or("design:type",Object)],e.prototype,"triggerReadOnQueryRefresh$",void 0),Rr([g.Effect(),Or("design:type",I.Observable)],e.prototype,"refreshQueriesOnDelete$",void 0),Rr([g.Effect(),Or("design:type",I.Observable)],e.prototype,"applyResources$",void 0),e}(),Cr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},mr={isCreating:0,isReading:0,isUpdating:0,isDeleting:0,isApplying:0,data:{},queries:{}},qr={zones:{}},wr=j,Lr=new v.InjectionToken("NGRX_JSON_API_CONFIG"),Ur=function(){function e(){}return e.configure=function(r){return{ngModule:e,providers:J(r)}},e.decorators=[{type:v.NgModule,args:[{declarations:[Ir,gr,Ar],imports:[g.EffectsModule.forFeature([Tr]),h.StoreModule.forFeature("NgrxJsonApi",wr,{})],exports:[Ir,gr,Ar]}]}],e.ctorParameters=function(){return[]},e}();e.SelectStoreResourcePipe=Ar,e.DenormaliseStoreResourcePipe=Ir,e.GetDenormalisedValuePipe=gr,e.NgrxJsonApiService=vr,e.NgrxJsonApiZoneService=Er,e.NgrxJsonApiModule=Ur,e.NGRX_JSON_API_CONFIG=Lr,e.uuid=Oe,e.NGRX_JSON_API_DEFAULT_ZONE=Y,e.Direction=M,e.NgrxJsonApiActionTypes=ze,e.NgrxJsonApiAction=Fe,e.ApiApplyInitAction=Qe,e.ApiApplySuccessAction=Je,e.ApiApplyFailAction=Ye,e.ApiPostInitAction=Me,e.ApiPostSuccessAction=$e,e.ApiPostFailAction=He,e.ApiDeleteInitAction=Ge,e.ApiDeleteSuccessAction=ke,e.ApiDeleteFailAction=We,e.ApiGetInitAction=Be,e.ApiGetSuccessAction=Ve,e.ApiGetFailAction=Ze,e.ApiRollbackAction=Ke,e.ApiPatchInitAction=Xe,e.ApiPatchSuccessAction=er,e.ApiPatchFailAction=rr,e.DeleteStoreResourceAction=tr,e.PatchStoreResourceAction=nr,e.NewStoreResourceAction=or,e.PostStoreResourceAction=ir,e.RemoveQueryAction=ar,e.LocalQueryInitAction=sr,e.LocalQuerySuccessAction=ur,e.LocalQueryFailAction=pr,e.CompactStoreAction=dr,e.ClearStoreAction=cr,e.ApiQueryRefreshAction=fr,e.ModifyStoreResourceErrorsAction=lr,e.selectNgrxJson=T,e.selectNgrxJsonApiDefaultZone=C,e.selectNgrxJsonApiZone=m,e.getNgrxJsonApiZone=q,e.selectStoreQuery=w,e.selectStoreResourcesOfType=L,e.selectStoreResource=U,e.selectManyQueryResult=b,e.selectOneQueryResult=D,e.getNgrxJsonApiStore=N,e.NgrxJsonApiSelectors=je,e.ɵf=Sr,e.ɵe=Tr,e.ɵa=z,e.ɵd=J,e.ɵb=F,e.ɵc=Q,e.ɵg=j,e.ɵh=wr,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/bundles/ngrx-json-api.umd.min.js.map